<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="stylesheet" href="design-system.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Station Operation Detail - AlwaysControl</title>

    <!-- Standard Stylesheets -->
    <link rel="stylesheet" href="components/common-styles.css">
    <link rel="stylesheet" href="components/header-nav.css">
    <link rel="stylesheet" href="components/i18n.css">
    <link rel="stylesheet" href="components/notification-center.css">
    <link rel="stylesheet" href="components/user-dropdown.css">
    <link rel="stylesheet" href="components/standard-layout.css">

    <!-- Standard Scripts -->
    <script src="components/i18n.js"></script>
    <script src="components/simple-message-icon.js"></script>
    <script src="components/user-dropdown-simple-new.js"></script>
    <script src="components/header-nav.js"></script>
    <script src="vendor/echarts.min.js"></script>

    <style>
        /* Page Container */
        body {
            background: #000 !important;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(0, 255, 136, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 122, 255, 0.03) 0%, transparent 50%);
            background-attachment: fixed;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 100px 30px 40px;
            min-height: calc(100vh - 140px);
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header Section */
        .detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 2px solid transparent;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent) bottom / 100% 2px no-repeat;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
            backdrop-filter: blur(10px);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--color-text);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .back-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .back-button:hover::before {
            left: 100%;
        }

        .back-button:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 255, 136, 0.05));
            transform: translateX(-5px);
            border-color: var(--color-primary);
        }

        .back-icon {
            font-size: 18px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .back-button:hover .back-icon {
            transform: translateX(-5px);
        }

        .detail-title-section {
            flex: 1;
            margin: 0 30px;
        }

        .detail-title {
            font-size: 32px;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, #fff 0%, rgba(0, 255, 136, 0.9) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            animation: titleGlow 3s ease-in-out infinite;
            display: inline-block;
        }

        .title-row {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        @keyframes titleGlow {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.95;
            }
        }

        .detail-subtitle {
            font-size: 14px;
            margin: 0;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: fadeIn 0.8s ease-out 0.2s backwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .date-selector-wrapper {
            animation: fadeIn 0.8s ease-out 0.3s backwards;
        }

        .date-selector {
            font-size: 16px;
            padding: 10px 18px;
            border-radius: 10px;
            border: 1.5px solid rgba(0, 255, 136, 0.3);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05));
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            outline: none;
            font-weight: 600;
            min-width: 200px;
        }

        .date-selector:hover {
            border-color: rgba(0, 255, 136, 0.5);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 255, 136, 0.08));
            transform: translateY(-2px);
        }

        .date-selector:focus {
            border-color: #00ff88;
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .date-selector option {
            background: #1a1a1a;
            color: var(--color-text);
            padding: 8px;
        }

        .subtitle-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .subtitle-item:hover {
            background: rgba(0, 255, 136, 0.08);
            transform: translateY(-2px);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.15), rgba(0, 122, 255, 0.05));
            backdrop-filter: blur(10px);
            border: 1.5px solid rgba(0, 122, 255, 0.3);
            border-radius: 10px;
            color: var(--color-text);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 122, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .action-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.25), rgba(0, 122, 255, 0.1));
            border-color: #007aff;
            transform: translateY(-3px);
        }

        .action-btn span {
            position: relative;
            z-index: 1;
        }


        .chart-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
            backdrop-filter: blur(20px);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 32px;
            position: relative;
            overflow: hidden;
            animation: cardSlideIn 0.8s ease-out 0.4s backwards;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.5), transparent);
        }

        .chart-card:hover {
            transform: translateY(-4px);
            border-color: rgba(0, 255, 136, 0.2);
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
        }

        .chart-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--color-primary), transparent);
            transition: width 0.8s ease;
        }

        .chart-card:hover .chart-header::after {
            width: 100%;
        }

        .chart-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--color-text);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.3px;
        }

        .chart-icon-badge {
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.25), rgba(0, 255, 136, 0.1));
            border-radius: 10px;
            font-size: 18px;
            transition: all 0.4s ease;
            animation: iconFloat 3s ease-in-out infinite;
        }

        @keyframes iconFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-4px);
            }
        }

        .chart-card:hover .chart-icon-badge {
            transform: rotate(10deg) scale(1.1);
        }

        .chart-container {
            position: relative;
            width: 100%;
            padding: 32px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
            backdrop-filter: blur(20px);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chart-container:hover {
            transform: translateY(-4px);
            border-color: rgba(0, 255, 136, 0.2);
        }

        .chart-container #operationsChart {
            height: 500px;
        }

        /* Operations Table */
        .operations-table-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
            backdrop-filter: blur(20px);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 32px;
            animation: cardSlideIn 0.8s ease-out 0.5s backwards;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .operations-table-card:hover {
            transform: translateY(-4px);
            border-color: rgba(0, 122, 255, 0.2);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
        }

        .table-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #007aff, transparent);
            transition: width 0.8s ease;
        }

        .operations-table-card:hover .table-header::after {
            width: 100%;
        }

        .table-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--color-text);
            margin: 0;
            letter-spacing: -0.3px;
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(0, 0, 0, 0.2);
        }

        .table-wrapper::-webkit-scrollbar {
            height: 8px;
        }

        .table-wrapper::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 136, 0.3);
            border-radius: 6px;
            transition: background 0.3s ease;
        }

        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 136, 0.5);
        }

        .operations-table {
            width: 100%;
            border-collapse: collapse;
        }

        .operations-table th {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
            padding: 16px 18px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            border-bottom: 2px solid rgba(0, 255, 136, 0.2);
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }

        .operations-table th::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--color-primary), transparent);
            transition: width 0.4s ease;
        }

        .operations-table:hover th::after {
            width: 100%;
        }

        .operations-table td {
            padding: 16px 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            font-size: 14px;
            color: var(--color-text);
            transition: all 0.3s ease;
        }

        .operations-table tbody tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .operations-table tbody tr::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 0;
            background: linear-gradient(180deg, var(--color-primary), transparent);
            transition: height 0.3s ease;
        }

        .operations-table tbody tr:hover::before {
            height: 100%;
        }

        .operations-table tbody tr:hover {
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.05), rgba(255, 255, 255, 0.03));
            transform: translateX(4px);
        }

        .operations-table tbody tr:hover td {
            color: rgba(255, 255, 255, 0.95);
        }

        /* Command Badge */
        .command-badge {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            padding: 7px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            border: 1.5px solid;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .command-badge::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .command-badge:hover::before {
            transform: translateX(100%);
        }

        .command-badge.charge {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
            color: #00ff88;
            border-color: rgba(0, 255, 136, 0.4);
        }

        .command-badge.charge:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 255, 136, 0.15));
            transform: translateY(-2px);
        }

        .command-badge.discharge {
            background: linear-gradient(135deg, rgba(255, 214, 10, 0.2), rgba(255, 214, 10, 0.1));
            color: #FFD60A;
            border-color: rgba(255, 214, 10, 0.4);
        }

        .command-badge.discharge:hover {
            background: linear-gradient(135deg, rgba(255, 214, 10, 0.3), rgba(255, 214, 10, 0.15));
            transform: translateY(-2px);
        }

        .badge-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.3);
            }
        }

        /* Source Badge */
        .source-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            border: 1.5px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .source-badge::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .source-badge:hover::before {
            opacity: 1;
        }

        .source-badge.aemo {
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 149, 0, 0.1));
            color: #ff9500;
            border-color: rgba(255, 149, 0, 0.4);
        }

        .source-badge.aemo:hover {
            transform: translateY(-2px);
        }

        .source-badge.ems {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.2), rgba(0, 122, 255, 0.1));
            color: #007aff;
            border-color: rgba(0, 122, 255, 0.4);
        }

        .source-badge.ems:hover {
            transform: translateY(-2px);
        }

        .source-badge.manual {
            background: linear-gradient(135deg, rgba(88, 86, 214, 0.2), rgba(88, 86, 214, 0.1));
            color: #5856d6;
            border-color: rgba(88, 86, 214, 0.4);
        }

        .source-badge.manual:hover {
            transform: translateY(-2px);
        }

        .source-badge.vpp {
            background: linear-gradient(135deg, rgba(90, 200, 250, 0.2), rgba(90, 200, 250, 0.1));
            color: #5ac8fa;
            border-color: rgba(90, 200, 250, 0.4);
        }

        .source-badge.vpp:hover {
            transform: translateY(-2px);
        }

        /* Result Badge */
        .result-badge {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            padding: 7px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            border: 1.5px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .result-badge::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .result-badge:hover::before {
            opacity: 1;
        }

        .result-badge::after {
            content: '‚úì';
            margin-right: 2px;
            font-size: 10px;
            opacity: 0.8;
        }

        .result-badge.failed::after {
            content: '‚úï';
        }

        .result-badge.partial::after {
            content: '‚óê';
        }

        .result-badge.success {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
            color: #00ff88;
            border-color: rgba(0, 255, 136, 0.4);
        }

        .result-badge.success:hover {
            transform: translateY(-2px);
        }

        .result-badge.completed {
            background: linear-gradient(135deg, rgba(52, 199, 89, 0.2), rgba(52, 199, 89, 0.1));
            color: #34c759;
            border-color: rgba(52, 199, 89, 0.4);
        }

        .result-badge.completed:hover {
            transform: translateY(-2px);
        }

        .result-badge.partial {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.2), rgba(255, 204, 0, 0.1));
            color: #ffcc00;
            border-color: rgba(255, 204, 0, 0.4);
        }

        .result-badge.partial:hover {
            transform: translateY(-2px);
        }

        .result-badge.failed {
            background: linear-gradient(135deg, rgba(255, 59, 48, 0.2), rgba(255, 59, 48, 0.1));
            color: #ff3b30;
            border-color: rgba(255, 59, 48, 0.4);
        }

        .result-badge.failed:hover {
            transform: translateY(-2px);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 30px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .toast {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(20, 20, 20, 0.95));
            backdrop-filter: blur(30px);
            border: 1.5px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 18px 22px;
            display: flex;
            align-items: center;
            gap: 14px;
            min-width: 320px;
            transform: translateX(450px) scale(0.9);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, currentColor, transparent);
        }

        .toast.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        .toast-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            flex-shrink: 0;
            animation: iconPop 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes iconPop {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .toast.success {
            border-color: rgba(0, 255, 136, 0.3);
            color: #00ff88;
        }

        .toast.success .toast-icon {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
        }

        .toast.error {
            border-color: rgba(255, 59, 48, 0.3);
            color: #ff3b30;
        }

        .toast.error .toast-icon {
            background: linear-gradient(135deg, #ff3b30, #cc2a22);
            color: #fff;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-size: 15px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }

        /* Loading Animation */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 1;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 136, 0.1);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 24px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 500;
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(0, 255, 136, 0.4), rgba(0, 255, 136, 0.2));
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(0, 255, 136, 0.6), rgba(0, 255, 136, 0.3));
        }

        /* Selection Styling */
        ::selection {
            background: rgba(0, 255, 136, 0.3);
            color: #fff;
        }

        /* Custody Timeline Styles */
        .custody-timeline {
            position: relative;
            width: 100%;
            height: 80px;
            overflow: visible;
        }

        .timeline-bar {
            position: absolute;
            top: 30px;
            left: 0;
            right: 0;
            height: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            overflow: visible;
        }

        .timeline-segment {
            position: absolute;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.85), rgba(0, 200, 255, 0.85));
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: visible;
            z-index: 10;
        }

        .timeline-segment:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.95), rgba(0, 200, 255, 0.95));
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            transform: scaleY(1.1);
        }

        .timeline-ticks {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .timeline-tick {
            position: absolute;
            top: 25px;
            width: 2px;
            height: 25px;
            background: rgba(255, 255, 255, 0.25);
        }

        .timeline-tick-label {
            position: absolute;
            top: 52px;
            transform: translateX(-50%);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
            white-space: nowrap;
        }

        .timeline-tooltip {
            position: absolute;
            bottom: 28px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 10, 0.98);
            border: 1px solid rgba(0, 255, 136, 0.5);
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 12px;
            color: #fff;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
            backdrop-filter: blur(12px);
            box-shadow: 0 4px 16px rgba(0, 255, 136, 0.25), 0 0 20px rgba(0, 0, 0, 0.6);
            font-weight: 400;
            letter-spacing: 0.3px;
        }

        .timeline-tooltip::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid rgba(10, 10, 10, 0.98);
        }

        .timeline-segment:hover .timeline-tooltip {
            opacity: 1;
            visibility: visible;
            bottom: 32px;
        }

        /* Focus Outline */
        *:focus-visible {
            outline: 2px solid rgba(0, 255, 136, 0.5);
            outline-offset: 2px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 90px 20px 30px;
            }

            .detail-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .detail-title-section {
                margin: 0;
            }

            .detail-title {
                font-size: 24px;
            }


            .action-buttons {
                width: 100%;
            }

            .action-btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Âä†ËΩΩËøêËê•Êï∞ÊçÆ‰∏≠...</div>
    </div>

    <!-- Header Container -->
    <div id="headerContainer"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Detail Header -->
        <div class="detail-header">
            <a href="operation-log-page.html" class="back-button">
                <span class="back-icon">‚Üê</span>
                <span>ËøîÂõûÂàóË°®</span>
            </a>
            <div class="detail-title-section">
                <div class="title-row">
                    <h1 class="detail-title" id="stationName">Âä†ËΩΩ‰∏≠...</h1>
                    <div class="date-selector-wrapper">
                        <select id="dateSelector" class="date-selector">
                            <option value="">Âä†ËΩΩ‰∏≠...</option>
                        </select>
                    </div>
                    <div class="date-selector-wrapper">
                        <select id="operationModeSelector" class="date-selector">
                            <option value="all">ÂÖ®ÈÉ®Êìç‰Ωú</option>
                            <option value="auto">Êô∫ËÉΩÊìç‰Ωú</option>
                            <option value="manual">‰∫∫Â∑•Êìç‰Ωú</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>


        <!-- Price & Operations Analysis -->
        <div class="chart-container">
            <h2 style="font-size: 24px; font-weight: 600; color: var(--color-text); margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 28px;">üìà</span>
                Ë∞ÉÂ∫¶ËÆ∞ÂΩï
            </h2>
            <div id="operationsChart" style="width: 100%; height: 450px;"></div>

            <!-- Êô∫ËÉΩÊâòÁÆ° -->
            <div style="margin-top: 30px;">
                <h3 style="font-size: 16px; font-weight: 600; color: var(--color-text); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 18px;">ü§ñ</span>
                    Êô∫ËÉΩÊâòÁÆ°
                </h3>
                <div id="dayTimeline" style="width: 100%; height: 80px;"></div>
            </div>
        </div>

    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ========== Global Variables ==========
        let toastCounter = 0;
        let operationsData = [];
        let filteredOperationsData = []; // Á≠õÈÄâÂêéÁöÑÊï∞ÊçÆ
        let chart = null;
        let currentOperationFilter = 'all'; // ÂΩìÂâçÊìç‰ΩúÊñπÂºèÁ≠õÈÄâÔºöall, auto, manual

        // ========== Get URL Parameters ==========
        const urlParams = new URLSearchParams(window.location.search);
        const selectedDate = urlParams.get('date') || new Date().toISOString().split('T')[0];
        const selectedStation = decodeURIComponent(urlParams.get('station') || '');
        const operationMode = urlParams.get('mode') || 'hybrid'; // manual, automated, hybrid

        // ========== Mock Data Generation ==========
        function generateMockData() {
            const sources = ['AEMO', 'EMS', 'Manual', 'VPP'];
            const results = ['success', 'completed'];
            const manualOperators = ['ÊùéÊÄ°ÊÇ¶', 'Áéã‰πêÂ∫∑', 'Âº†‰∏â'];
            const regions = ['NSW', 'QLD', 'VIC', 'SA', 'TAS'];
            const maxPower = 5; // 5MWÁîµÁ´ô

            // ÁîüÊàêÁúüÂÆûÁöÑ‰ª∑Ê†ºÊõ≤Á∫øÔºà‰ΩéË∞∑ÂíåÈ´òÂ≥∞ÊòéÊòæÔºâ
            const basePrice = 0.15;
            const hourlyPrices = [];
            for (let hour = 0; hour < 24; hour++) {
                // ‰ª∑Ê†ºÊ®°ÂºèÔºöÂáåÊô®‰Ωé‰ª∑ÔºåÁôΩÂ§©È´ò‰ª∑ÔºåÊôö‰∏äÊ¨°È´ò‰ª∑
                let price;
                if (hour >= 0 && hour < 6) {
                    // ÂáåÊô®‰Ωé‰ª∑Êó∂ÊÆµ (0.08-0.12)
                    price = 0.08 + Math.random() * 0.04;
                } else if (hour >= 6 && hour < 10) {
                    // Êó©‰∏äÊ¨°‰Ωé‰ª∑ (0.12-0.16)
                    price = 0.12 + Math.random() * 0.04;
                } else if (hour >= 10 && hour < 16) {
                    // ÁôΩÂ§©È´ò‰ª∑Êó∂ÊÆµ (0.18-0.25)
                    price = 0.18 + Math.random() * 0.07;
                } else if (hour >= 16 && hour < 20) {
                    // ÂÇçÊôöÊ¨°È´ò‰ª∑ (0.16-0.22)
                    price = 0.16 + Math.random() * 0.06;
                } else {
                    // Êôö‰∏ä‰∏≠Á≠â‰ª∑Ê†º (0.14-0.18)
                    price = 0.14 + Math.random() * 0.04;
                }
                hourlyPrices.push(price);
            }

            // ËÆ°ÁÆó‰ª∑Ê†ºÈòàÂÄºÔºàÁî®‰∫éÂÜ≥Á≠ñÔºâ
            const sortedPrices = [...hourlyPrices].sort((a, b) => a - b);
            const lowPriceThreshold = sortedPrices[6]; // Ââç25%ÁöÑ‰ª∑Ê†º
            const highPriceThreshold = sortedPrices[18]; // Âêé25%ÁöÑ‰ª∑Ê†º

            const data = [];

            // ËÆæËÆ°Êõ¥ÁúüÂÆûÁöÑË∞ÉÂ∫¶Ê®°ÂºèÔºö
            // 1. Êó©‰∏ä0-6ÁÇπÔºöÊô∫ËÉΩÊâòÁÆ°ÂÖÖÁîµÔºà‰Ωé‰ª∑Êó∂ÊÆµÔºâ
            // 2. Êó©‰∏ä6-12ÁÇπÔºö‰∫∫Â∑•Ë∞ÉÂ∫¶ÔºåÊ†πÊçÆÂÆûÊó∂‰ª∑Ê†ºÂÜ≥Á≠ñ
            // 3. ‰∏ãÂçà12-18ÁÇπÔºöÊô∫ËÉΩÊâòÁÆ°ÊîæÁîµÔºàÈ´ò‰ª∑Êó∂ÊÆµÔºâ
            // 4. Êôö‰∏ä18-24ÁÇπÔºö‰∫∫Â∑•Ë∞ÉÂ∫¶

            // ========== ‰ªøÁúüÊï∞ÊçÆÔºöÊ†πÊçÆÊìç‰ΩúÊ®°ÂºèÁîüÊàê‰∏çÂêåÁöÑÊìç‰ΩúÊÆµ ==========
            let scheduleBlocks = [];

            if (operationMode === 'manual') {
                // Á∫Ø‰∫∫Â∑•Ê®°ÂºèÔºö1Ê¨°ÂÖÖÁîµ„ÄÅ1Ê¨°ÊîæÁîµ
                scheduleBlocks = [
                    {
                        start: 0, end: 6, mode: 'manual', command: 'charge',
                        reason: '‰ΩéÁîµ‰ª∑ÂÖÖÁîµ' // ‰ª∑Ê†ºÁ∫¶0.08-0.12ÔºåÂáåÊô®0-6ÁÇπËøûÁª≠ÂÖÖÁîµ
                    },
                    {
                        start: 13, end: 18, mode: 'manual', command: 'discharge',
                        reason: 'È´òÁîµ‰ª∑ÊîæÁîµ' // ‰ª∑Ê†ºÁ∫¶0.18-0.25Ôºå‰∏ãÂçà13-18ÁÇπËøûÁª≠ÊîæÁîµ
                    }
                ];
            } else if (operationMode === 'automated') {
                // Á∫ØÊô∫ËÉΩÊâòÁÆ°Ê®°ÂºèÔºöÂÖÖ1Ê¨°ÔºåÊîæ1Ê¨°
                scheduleBlocks = [
                    {
                        start: 0, end: 6, mode: 'auto', command: 'charge',
                        reason: '‰ΩéÁîµ‰ª∑ÂÖÖÁîµ' // ‰ª∑Ê†ºÁ∫¶0.08-0.12ÔºåÂáåÊô®0-6ÁÇπËøûÁª≠ÂÖÖÁîµ
                    },
                    {
                        start: 13, end: 18, mode: 'auto', command: 'discharge',
                        reason: 'È´òÁîµ‰ª∑ÊîæÁîµ' // ‰ª∑Ê†ºÁ∫¶0.18-0.25Ôºå‰∏ãÂçà13-18ÁÇπËøûÁª≠ÊîæÁîµ
                    }
                ];
            } else {
                // Ê∑∑ÂêàÊ®°Âºè(hybrid)Ôºö2Êô∫ËÉΩ + 2‰∫∫Â∑•
                scheduleBlocks = [
                    {
                        start: 0, end: 2, mode: 'auto', command: 'charge',
                        reason: '‰ΩéÁîµ‰ª∑ÂÖÖÁîµ' // ‰ª∑Ê†ºÁ∫¶0.08-0.12
                    },
                    {
                        start: 7, end: 8, mode: 'manual', command: 'charge',
                        reason: 'Ê¨°‰ΩéÁîµ‰ª∑ÂÖÖÁîµ' // ‰ª∑Ê†ºÁ∫¶0.12-0.16
                    },
                    {
                        start: 13, end: 15, mode: 'auto', command: 'discharge',
                        reason: 'È´òÁîµ‰ª∑ÊîæÁîµ' // ‰ª∑Ê†ºÁ∫¶0.18-0.25
                    },
                    {
                        start: 18, end: 19, mode: 'manual', command: 'discharge',
                        reason: 'Ê¨°È´òÁîµ‰ª∑ÊîæÁîµ' // ‰ª∑Ê†ºÁ∫¶0.16-0.22
                    }
                ];
            }

            scheduleBlocks.forEach(block => {
                // ‰∏∫ÊØè‰∏™Â∞èÊó∂ÁîüÊàê‰∏ÄÊù°Êìç‰ΩúËÆ∞ÂΩï
                for (let hour = block.start; hour < block.end; hour++) {
                    const minute = Math.floor(Math.random() * 60);
                    const timeStr = `${selectedDate} ${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;

                    // ÂÜ≥ÂÆöÊìç‰ΩúÂëò
                    const isAuto = block.mode === 'auto';
                    const operator = isAuto ? 'Á≥ªÁªüËá™Âä®' : manualOperators[Math.floor(Math.random() * manualOperators.length)];

                    // ÂäüÁéáÔºöÈôêÂà∂Âú®0.5-5MWËåÉÂõ¥ÂÜÖÔºåÂÖÖÁîµÊó∂Á®çÈ´òÔºåÊîæÁîµÊó∂Á®ç‰Ωé
                    const basePower = block.command === 'charge' ? 4 : 3.5;
                    const power = (basePower + (Math.random() - 0.5) * 1.5).toFixed(1);
                    const clampedPower = Math.max(0.5, Math.min(maxPower, parseFloat(power))).toFixed(1);

                    data.push({
                        time: timeStr,
                        hour: hour,
                        command: block.command,
                        source: sources[Math.floor(Math.random() * sources.length)],
                        power: clampedPower,
                        duration: Math.floor(Math.random() * 50 + 30), // 30-80ÂàÜÈíü
                        operator: operator,
                        isAuto: isAuto,
                        result: results[Math.floor(Math.random() * results.length)],
                        region: regions[Math.floor(Math.random() * regions.length)],
                        price: hourlyPrices[hour], // ËÆ∞ÂΩïÂΩìÊó∂ÁöÑ‰ª∑Ê†º
                        reason: block.reason // ËÆ∞ÂΩïÂÜ≥Á≠ñÂéüÂõ†
                    });
                }
            });

            // Sort by time
            data.sort((a, b) => new Date(a.time) - new Date(b.time));

            return data;
        }

        // ========== Initialize Page ==========
        function initializePage() {
            // Update page header
            document.getElementById('stationName').textContent = selectedStation;

            // Initialize date selector
            initializeDateSelector();

            // Generate mock data
            operationsData = generateMockData();

            // Render charts
            renderChart();
            renderDayTimeline();

            // Hide loading overlay with delay for smooth transition
            setTimeout(() => {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (loadingOverlay) {
                    loadingOverlay.classList.add('hidden');
                }

                // Show success toast after loading completes
                setTimeout(() => {
                    showToast('success', 'Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê', `Â∑≤Âä†ËΩΩ ${selectedStation} Âú® ${selectedDate} ÁöÑËøêËê•Êï∞ÊçÆ`);
                }, 300);
            }, 800);
        }

        // ========== Initialize Date Selector ==========
        function initializeDateSelector() {
            const dateSelector = document.getElementById('dateSelector');
            if (!dateSelector) return;

            // Generate date options (last 30 days)
            const dates = [];
            const today = new Date();

            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                dates.push(dateStr);
            }

            // Clear existing options
            dateSelector.innerHTML = '';

            // Add date options
            dates.forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = `üìÖ ${date}`;
                if (date === selectedDate) {
                    option.selected = true;
                }
                dateSelector.appendChild(option);
            });

            // Listen for date changes
            dateSelector.addEventListener('change', (e) => {
                const newDate = e.target.value;
                if (newDate && newDate !== selectedDate) {
                    // Update URL and reload
                    const params = new URLSearchParams(window.location.search);
                    params.set('date', newDate);
                    window.location.search = params.toString();
                }
            });
        }


        // ========== Generate Price Data (5-minute intervals) ==========
        function generatePriceData() {
            const actualPrices = [];
            const predictedPrices = [];
            const dataPoints = 288; // 24 hours * 12 (5-minute intervals per hour)

            for (let i = 0; i < dataPoints; i++) {
                const hour = Math.floor(i / 12);

                // Âü∫‰∫éÂ∞èÊó∂ÁöÑ‰ª∑Ê†ºËåÉÂõ¥
                let basePrice;
                if (hour >= 0 && hour < 6) {
                    // ÂáåÊô®‰Ωé‰ª∑Êó∂ÊÆµ (0.08-0.12)
                    basePrice = 0.08 + Math.random() * 0.04;
                } else if (hour >= 6 && hour < 10) {
                    // Êó©‰∏äÊ¨°‰Ωé‰ª∑ (0.12-0.16)
                    basePrice = 0.12 + Math.random() * 0.04;
                } else if (hour >= 10 && hour < 16) {
                    // ÁôΩÂ§©È´ò‰ª∑Êó∂ÊÆµ (0.18-0.25)
                    basePrice = 0.18 + Math.random() * 0.07;
                } else if (hour >= 16 && hour < 20) {
                    // ÂÇçÊôöÊ¨°È´ò‰ª∑ (0.16-0.22)
                    basePrice = 0.16 + Math.random() * 0.06;
                } else {
                    // Êôö‰∏ä‰∏≠Á≠â‰ª∑Ê†º (0.14-0.18)
                    basePrice = 0.14 + Math.random() * 0.04;
                }

                // Actual prices with small variation
                const noise = (Math.random() - 0.5) * 0.01;
                actualPrices.push((basePrice + noise).toFixed(3));

                // Predicted prices (similar but slightly different)
                const predictNoise = (Math.random() - 0.5) * 0.015;
                predictedPrices.push((basePrice + predictNoise).toFixed(3));
            }

            return { actualPrices, predictedPrices };
        }

        // ========== Generate SOC Data (State of Charge) ==========
        function generateSOCData() {
            const socData = [];
            const dataPoints = 288; // 24Â∞èÊó∂ * 12‰∏™5ÂàÜÈíüÈó¥Èöî
            let currentSOC = 30; // ÂàùÂßãSOCËÆæ‰∏∫30%ÔºåËøôÊ†∑ÂÖÖÁîµÂêéËÉΩËææÂà∞ËæÉÈ´òÊ∞¥Âπ≥

            for (let i = 0; i < dataPoints; i++) {
                const hour = Math.floor(i / 12);
                const ops = operationsData.filter(op => op.hour === hour);

                if (ops.length > 0) {
                    // ÂèñÁ¨¨‰∏ÄÊù°Êìç‰ΩúËÆ∞ÂΩïÔºàÊØèÂ∞èÊó∂Âè™Êúâ‰∏ÄÊù°Ôºâ
                    const op = ops[0];

                    if (op.command === 'charge') {
                        // ÂÖÖÁîµÔºöÊØè5ÂàÜÈíü‰∏äÂçáÁ∫¶0.7-0.95%
                        // ÁõÆÊ†áÔºö0-6ÁÇπÔºà6Â∞èÊó∂=72‰∏™5ÂàÜÈíüÈó¥ÈöîÔºâ‰ªé30%ÂÖÖÂà∞90%ÔºåÊÄªÂÖ±‰∏äÂçá60%
                        // Âπ≥ÂùáÊØè‰∏™Èó¥Èöî‰∏äÂçáÔºö60% / 72 ‚âà 0.83%
                        // ËÆæÁΩÆÈÄüÁéá‰∏∫ 0.7-0.95%ÔºåËÆ©ÂÖÖÁîµËøáÁ®ãÊõ¥ÂùáÂåÄÔºåÂú®Êï¥‰∏™6Â∞èÊó∂ÂÜÖÂÆåÊàê
                        if (currentSOC < 90) {
                            const chargeRate = 0.70 + Math.random() * 0.25;
                            currentSOC = Math.min(90, currentSOC + chargeRate);
                        }
                    } else if (op.command === 'discharge') {
                        // ÊîæÁîµÔºöÊØè5ÂàÜÈíü‰∏ãÈôçÁ∫¶0.9-1.15%
                        // ÁõÆÊ†áÔºö13-18ÁÇπÔºà5Â∞èÊó∂=60‰∏™5ÂàÜÈíüÈó¥ÈöîÔºâ‰ªé90%ÊîæÂà∞30%ÔºåÊÄªÂÖ±‰∏ãÈôç60%
                        // Âπ≥ÂùáÊØè‰∏™Èó¥Èöî‰∏ãÈôçÔºö60% / 60 = 1%
                        // ËÆæÁΩÆÈÄüÁéá‰∏∫ 0.9-1.15%ÔºåËÆ©ÊîæÁîµËøáÁ®ãÊõ¥ÂùáÂåÄÔºåÂú®Êï¥‰∏™5Â∞èÊó∂ÂÜÖÂÆåÊàê
                        if (currentSOC > 30) {
                            const dischargeRate = 0.90 + Math.random() * 0.25;
                            currentSOC = Math.max(30, currentSOC - dischargeRate);
                        }
                    }
                } else {
                    // Êó†Êìç‰ΩúÊó∂‰øùÊåÅÁ®≥ÂÆöÔºå‰ªÖÊúâÂæÆÂ∞èËá™ÁÑ∂ÊçüËÄó
                    currentSOC += (Math.random() - 0.6) * 0.15; // ËΩªÂæÆ‰∏ãÈôçË∂ãÂäø
                    currentSOC = Math.max(25, Math.min(92, currentSOC));
                }

                socData.push(currentSOC.toFixed(1));
            }

            return socData;
        }

        // ========== Render Chart ==========
        function renderChart() {
            const chartDom = document.getElementById('operationsChart');
            chart = echarts.init(chartDom, 'dark');

            // Generate price data and SOC data
            const { actualPrices, predictedPrices } = generatePriceData();
            const socData = generateSOCData();

            // Generate time labels (format: HH:mm, 5-minute intervals)
            const timeLabels = Array.from({length: 288}, (_, i) => {
                const totalMinutes = i * 5;
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            });

            // ÊåâÂ∞èÊó∂ÂàÜÁªÑÔºåÂêå‰∏ÄÂ∞èÊó∂Âè™‰øùÁïôÊúÄÂêé‰∏Ä‰∏™Êìç‰ΩúÔºàÂÖÖÁîµÂíåÊîæÁîµ‰∫íÊñ•Ôºâ
            const hourlyOperations = {};
            operationsData.forEach(op => {
                if (!hourlyOperations[op.hour] || new Date(op.time) > new Date(hourlyOperations[op.hour].time)) {
                    hourlyOperations[op.hour] = op;
                }
            });

            // ÊèêÂèñÂÖÖÁîµÂíåÊîæÁîµÁöÑÂ∞èÊó∂ÔºàÂå∫ÂàÜÊô∫ËÉΩÂíå‰∫∫Â∑•Ôºâ
            const autoChargeHours = [];
            const manualChargeHours = [];
            const autoDischargeHours = [];
            const manualDischargeHours = [];

            Object.values(hourlyOperations).forEach(op => {
                if (op.command === 'charge') {
                    if (op.isAuto) {
                        autoChargeHours.push(op.hour);
                    } else {
                        manualChargeHours.push(op.hour);
                    }
                } else if (op.command === 'discharge') {
                    if (op.isAuto) {
                        autoDischargeHours.push(op.hour);
                    } else {
                        manualDischargeHours.push(op.hour);
                    }
                }
            });

            autoChargeHours.sort((a, b) => a - b);
            manualChargeHours.sort((a, b) => a - b);
            autoDischargeHours.sort((a, b) => a - b);
            manualDischargeHours.sort((a, b) => a - b);

            // ÂêàÂπ∂ËøûÁª≠Â∞èÊó∂‰∏∫Êó∂ÊÆµ
            function mergeContinuousHours(hours) {
                if (hours.length === 0) return [];

                const periods = [];
                let start = hours[0];
                let end = hours[0];

                for (let i = 1; i < hours.length; i++) {
                    if (hours[i] === end + 1) {
                        // ËøûÁª≠ÁöÑÂ∞èÊó∂ÔºåÊâ©Â±ïÂΩìÂâçÊó∂ÊÆµ
                        end = hours[i];
                    } else {
                        // ‰∏çËøûÁª≠Ôºå‰øùÂ≠òÂΩìÂâçÊó∂ÊÆµÔºåÂºÄÂßãÊñ∞Êó∂ÊÆµ
                        periods.push({ start, end });
                        start = hours[i];
                        end = hours[i];
                    }
                }
                // ‰øùÂ≠òÊúÄÂêé‰∏Ä‰∏™Êó∂ÊÆµ
                periods.push({ start, end });
                return periods;
            }

            const autoChargePeriods = mergeContinuousHours(autoChargeHours);
            const manualChargePeriods = mergeContinuousHours(manualChargeHours);
            const autoDischargePeriods = mergeContinuousHours(autoDischargeHours);
            const manualDischargePeriods = mergeContinuousHours(manualDischargeHours);

            // ÊûÑÈÄ†ÂÖÖÁîµ markArea Êï∞ÊçÆÔºàÊåâÊô∫ËÉΩ/‰∫∫Â∑•ÂàÜÂà´ËÆæÁΩÆÈ¢úËâ≤Ôºâ
            const autoChargeMarkAreaData = [];
            autoChargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);
                autoChargeMarkAreaData.push([
                    { xAxis: timeLabels[startIdx], itemStyle: { color: 'rgba(0,255,136,0.18)' } }, // Êô∫ËÉΩÂÖÖÁîµÔºöÁªøËâ≤
                    { xAxis: timeLabels[endIdx] }
                ]);
            });

            const manualChargeMarkAreaData = [];
            manualChargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);
                manualChargeMarkAreaData.push([
                    { xAxis: timeLabels[startIdx], itemStyle: { color: 'rgba(255,184,77,0.18)' } }, // ‰∫∫Â∑•ÂÖÖÁîµÔºöÊ©ôËâ≤
                    { xAxis: timeLabels[endIdx] }
                ]);
            });

            // ÊûÑÈÄ†ÊîæÁîµ markArea Êï∞ÊçÆÔºàÊåâÊô∫ËÉΩ/‰∫∫Â∑•ÂàÜÂà´ËÆæÁΩÆÈ¢úËâ≤Ôºâ
            const autoDischargeMarkAreaData = [];
            autoDischargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);
                autoDischargeMarkAreaData.push([
                    { xAxis: timeLabels[startIdx], itemStyle: { color: 'rgba(255,214,10,0.18)' } }, // Êô∫ËÉΩÊîæÁîµÔºöÈªÑËâ≤
                    { xAxis: timeLabels[endIdx] }
                ]);
            });

            const manualDischargeMarkAreaData = [];
            manualDischargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);
                manualDischargeMarkAreaData.push([
                    { xAxis: timeLabels[startIdx], itemStyle: { color: 'rgba(255,107,107,0.18)' } }, // ‰∫∫Â∑•ÊîæÁîµÔºöÁ∫¢Ëâ≤
                    { xAxis: timeLabels[endIdx] }
                ]);
            });

            // ÊûÑÈÄ†ÂÖÖÁîµ markPoint Êï∞ÊçÆÔºàÊåâÊô∫ËÉΩ/‰∫∫Â∑•ÂàÜÂà´ËÆæÁΩÆÈ¢úËâ≤Ôºâ
            const autoChargeMarkPointData = [];
            autoChargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);

                // Êô∫ËÉΩÂÖÖÁîµÂºÄÂßãÊ†áËÆ∞
                autoChargeMarkPointData.push({
                    xAxis: timeLabels[startIdx],
                    yAxis: 'max',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, 8],
                    itemStyle: {
                        color: '#00ff88', // Êô∫ËÉΩÂÖÖÁîµÔºöÁªøËâ≤
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: 'ÂÖÖ',
                        fontSize: 10,
                        fontWeight: 600,
                        color: '#00ff88',
                        offset: [0, -18],
                        position: 'top'
                    }
                });

                // Êô∫ËÉΩÂÖÖÁîµÁªìÊùüÊ†áËÆ∞
                autoChargeMarkPointData.push({
                    xAxis: timeLabels[endIdx],
                    yAxis: 'max',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, -8],
                    itemStyle: {
                        color: '#00ff88',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: '‚ñ†',
                        fontSize: 8,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });
            });

            const manualChargeMarkPointData = [];
            manualChargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);

                // ‰∫∫Â∑•ÂÖÖÁîµÂºÄÂßãÊ†áËÆ∞
                manualChargeMarkPointData.push({
                    xAxis: timeLabels[startIdx],
                    yAxis: 'max',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, 8],
                    itemStyle: {
                        color: '#FFB84D', // ‰∫∫Â∑•ÂÖÖÁîµÔºöÊ©ôËâ≤
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: 'ÂÖÖ',
                        fontSize: 10,
                        fontWeight: 600,
                        color: '#FFB84D',
                        offset: [0, -18],
                        position: 'top'
                    }
                });

                // ‰∫∫Â∑•ÂÖÖÁîµÁªìÊùüÊ†áËÆ∞
                manualChargeMarkPointData.push({
                    xAxis: timeLabels[endIdx],
                    yAxis: 'max',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, -8],
                    itemStyle: {
                        color: '#FFB84D',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: '‚ñ†',
                        fontSize: 8,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });
            });

            // ÊûÑÈÄ†ÊîæÁîµ markPoint Êï∞ÊçÆÔºàÊåâÊô∫ËÉΩ/‰∫∫Â∑•ÂàÜÂà´ËÆæÁΩÆÈ¢úËâ≤Ôºâ
            const autoDischargeMarkPointData = [];
            autoDischargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);

                // Êô∫ËÉΩÊîæÁîµÂºÄÂßãÊ†áËÆ∞
                autoDischargeMarkPointData.push({
                    xAxis: timeLabels[startIdx],
                    yAxis: 'min',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, 8],
                    itemStyle: {
                        color: '#FFD60A', // Êô∫ËÉΩÊîæÁîµÔºöÈªÑËâ≤
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: 'Êîæ',
                        fontSize: 10,
                        fontWeight: 600,
                        color: '#FFD60A',
                        offset: [0, 18],
                        position: 'bottom'
                    }
                });

                // Êô∫ËÉΩÊîæÁîµÁªìÊùüÊ†áËÆ∞
                autoDischargeMarkPointData.push({
                    xAxis: timeLabels[endIdx],
                    yAxis: 'min',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, -8],
                    itemStyle: {
                        color: '#FFD60A',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: '‚ñ†',
                        fontSize: 8,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });
            });

            const manualDischargeMarkPointData = [];
            manualDischargePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);

                // ‰∫∫Â∑•ÊîæÁîµÂºÄÂßãÊ†áËÆ∞
                manualDischargeMarkPointData.push({
                    xAxis: timeLabels[startIdx],
                    yAxis: 'min',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, 8],
                    itemStyle: {
                        color: '#FF6B6B', // ‰∫∫Â∑•ÊîæÁîµÔºöÁ∫¢Ëâ≤
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: 'Êîæ',
                        fontSize: 10,
                        fontWeight: 600,
                        color: '#FF6B6B',
                        offset: [0, 18],
                        position: 'bottom'
                    }
                });

                // ‰∫∫Â∑•ÊîæÁîµÁªìÊùüÊ†áËÆ∞
                manualDischargeMarkPointData.push({
                    xAxis: timeLabels[endIdx],
                    yAxis: 'min',
                    symbol: 'circle',
                    symbolSize: 10,
                    symbolOffset: [0, -8],
                    itemStyle: {
                        color: '#FF6B6B',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: '‚ñ†',
                        fontSize: 8,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });
            });

            // ËØÜÂà´Ë∞ÉÂ∫¶Ê®°ÂºèÁöÑËøûÁª≠Êó∂ÊÆµ
            const sortedOps = Object.values(hourlyOperations).sort((a, b) => a.hour - b.hour);
            const modePeriods = [];

            for (let i = 0; i < sortedOps.length; i++) {
                const curr = sortedOps[i];
                const prev = i > 0 ? sortedOps[i - 1] : null;

                // Ê£ÄÊµãÊó∂ÊÆµÂºÄÂßãÔºöÁ¨¨‰∏Ä‰∏™Êìç‰Ωú„ÄÅÊ®°ÂºèÊîπÂèò„ÄÅÊàñÊó∂Èó¥‰∏çËøûÁª≠ÔºàÊúâÈó¥ÈöîÔºâ
                if (!prev || curr.isAuto !== prev.isAuto || curr.hour !== prev.hour + 1) {
                    // ÊâæÂà∞Ëøô‰∏™Êó∂ÊÆµÁöÑÁªìÊùü
                    let endHour = curr.hour;
                    for (let j = i + 1; j < sortedOps.length; j++) {
                        if (sortedOps[j].isAuto === curr.isAuto && sortedOps[j].hour === endHour + 1) {
                            endHour = sortedOps[j].hour;
                        } else {
                            break;
                        }
                    }

                    modePeriods.push({
                        start: curr.hour,
                        end: endHour,
                        isAuto: curr.isAuto
                    });
                }
            }

            // ÊûÑÈÄ†‰∫∫Â∑•/Êô∫ËÉΩÊ†áËÆ∞ markPoint Êï∞ÊçÆÔºàÊó∂ÊÆµÂºÄÂßãÂíåÁªìÊùüÔºåË∑üÈöèSOCÊõ≤Á∫øÔºâ
            const autoMarkPointData = [];
            modePeriods.forEach(period => {
                const startIdx = period.start * 12;
                const endIdx = Math.min((period.end + 1) * 12, 287);

                // ÂºÄÂßãÊ†áËÆ∞ - Ë∑üÈöèSOCÊõ≤Á∫ø
                autoMarkPointData.push({
                    xAxis: timeLabels[startIdx],
                    yAxis: parseFloat(socData[startIdx]), // Ë∑üÈöèSOCÊï∞ÊçÆ
                    symbol: 'circle',
                    symbolSize: 18,
                    symbolOffset: [0, 8],
                    itemStyle: {
                        color: period.isAuto ? 'rgba(138, 43, 226, 0.9)' : 'rgba(255, 140, 0, 0.9)',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: period.isAuto ? 'Êô∫' : '‰∫∫',
                        fontSize: 10,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });

                // ÂÅúÊ≠¢Ê†áËÆ∞ - Âú®Êó∂ÊÆµÁªìÊùü‰ΩçÁΩÆÊòæÁ§∫ÔºåË∑üÈöèSOCÊõ≤Á∫ø
                autoMarkPointData.push({
                    xAxis: timeLabels[endIdx],
                    yAxis: parseFloat(socData[endIdx]), // Ë∑üÈöèSOCÊï∞ÊçÆ
                    symbol: 'circle',
                    symbolSize: 18,
                    symbolOffset: [0, -8],
                    itemStyle: {
                        color: period.isAuto ? 'rgba(138, 43, 226, 0.9)' : 'rgba(255, 140, 0, 0.9)',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: '‚ñ†',
                        fontSize: 10,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });
            });

            // ========== Âä®ÊÄÅÁîüÊàê legend Êï∞ÊçÆ ==========
            const legendData = [
                { name: 'ÂÆûÈôÖ‰ª∑Ê†º', icon: 'rect', itemStyle: { color: 'rgba(0,255,136,0.7)' } },
                { name: 'È¢ÑÊµã‰ª∑Ê†º', icon: 'rect', itemStyle: { color: 'rgba(0,122,255,0.6)' } },
                { name: 'SOC', icon: 'rect', itemStyle: { color: 'rgba(138,43,226,0.8)' } }
            ];

            // Ê†πÊçÆÊìç‰ΩúÊ®°ÂºèÊ∑ªÂä†Êìç‰ΩúÊñπÂºèÂõæ‰æã
            if (operationMode === 'manual') {
                // Á∫Ø‰∫∫Â∑•Ê®°ÂºèÔºöÊòæÁ§∫‰∫∫Â∑•ÂÖÖÁîµÂíå‰∫∫Â∑•ÊîæÁîµ
                legendData.push(
                    { name: '‰∫∫Â∑•ÂÖÖÁîµ', icon: 'rect', itemStyle: { color: '#FFB84D' } }, // Ê©ôËâ≤
                    { name: '‰∫∫Â∑•ÊîæÁîµ', icon: 'rect', itemStyle: { color: '#FF6B6B' } }  // Á∫¢Ëâ≤
                );
            } else if (operationMode === 'automated') {
                // Á∫ØÊô∫ËÉΩÊ®°ÂºèÔºöÊòæÁ§∫Êô∫ËÉΩÂÖÖÁîµÂíåÊô∫ËÉΩÊîæÁîµ
                legendData.push(
                    { name: 'Êô∫ËÉΩÂÖÖÁîµ', icon: 'rect', itemStyle: { color: '#00ff88' } }, // ÁªøËâ≤
                    { name: 'Êô∫ËÉΩÊîæÁîµ', icon: 'rect', itemStyle: { color: '#FFD60A' } }  // ÈªÑËâ≤
                );
            } else {
                // Ê∑∑ÂêàÊ®°ÂºèÔºöÂàÜÂà´ÊòæÁ§∫Êô∫ËÉΩÂíå‰∫∫Â∑•ÁöÑÂÖÖÊîæÁîµ(4Ë°å)
                legendData.push(
                    { name: 'Êô∫ËÉΩÂÖÖÁîµ', icon: 'rect', itemStyle: { color: '#00ff88' } }, // ÁªøËâ≤
                    { name: 'Êô∫ËÉΩÊîæÁîµ', icon: 'rect', itemStyle: { color: '#FFD60A' } }, // ÈªÑËâ≤
                    { name: '‰∫∫Â∑•ÂÖÖÁîµ', icon: 'rect', itemStyle: { color: '#FFB84D' } }, // Ê©ôËâ≤
                    { name: '‰∫∫Â∑•ÊîæÁîµ', icon: 'rect', itemStyle: { color: '#FF6B6B' } }  // Á∫¢Ëâ≤
                );
            }

            legendData.push({ name: 'Ë∞ÉÂ∫¶Á±ªÂûã', icon: 'circle', itemStyle: { color: 'rgba(138, 43, 226, 0.9)' } });

            const option = {
                backgroundColor: 'transparent',
                legend: {
                    data: legendData,
                    top: 10,
                    right: 20,
                    orient: 'horizontal',
                    itemGap: 20,
                    textStyle: {
                        color: 'rgba(255,255,255,0.7)',
                        fontSize: 12,
                        fontWeight: 500
                    },
                    itemWidth: 28,
                    itemHeight: 4,
                    inactiveColor: 'rgba(255,255,255,0.2)',
                    selectedMode: true
                },
                grid: {
                    left: 50,
                    right: 60,
                    top: 50,
                    bottom: 35,
                    containLabel: false
                },
                xAxis: {
                    type: 'category',
                    data: timeLabels,
                    boundaryGap: false,
                    axisLine: { show: false },
                    axisTick: { show: false },
                    axisLabel: {
                        show: true,
                        fontSize: 10,
                        color: 'rgba(255,255,255,0.5)',
                        interval: function(idx) { return idx % 12 === 0; }, // ÊØèÂ∞èÊó∂ÊòæÁ§∫‰∏ÄÊ¨°
                        formatter: function(v) { return v.substring(0, 5); } // Âè™ÊòæÁ§∫ HH:mm
                    },
                    splitLine: { show: false }
                },
                yAxis: [
                    {
                        // Â∑¶‰æßYËΩ¥ - ‰ª∑Ê†º
                        type: 'value',
                        position: 'left',
                        axisLine: { show: false },
                        axisTick: { show: false },
                        axisLabel: {
                            show: true,
                            fontSize: 10,
                            color: 'rgba(255,255,255,0.5)',
                            formatter: '${value}'
                        },
                        splitLine: {
                            show: true,
                            lineStyle: { color: 'rgba(255,255,255,0.05)' }
                        },
                        splitNumber: 4
                    },
                    {
                        // Âè≥‰æßYËΩ¥ - SOC
                        type: 'value',
                        position: 'right',
                        min: 0,
                        max: 100,
                        axisLine: { show: false },
                        axisTick: { show: false },
                        axisLabel: {
                            show: true,
                            fontSize: 10,
                            color: 'rgba(138, 43, 226, 0.7)',
                            formatter: '{value}%'
                        },
                        splitLine: { show: false }
                    }
                ],
                series: [
                    {
                        // ÂÆûÈôÖ‰ª∑Ê†ºÔºàÂÆûÁ∫øÔºâ
                        name: 'ÂÆûÈôÖ‰ª∑Ê†º',
                        type: 'line',
                        smooth: true,
                        showSymbol: false,
                        data: actualPrices,
                        yAxisIndex: 0,
                        lineStyle: {
                            color: 'rgba(0,255,136,0.7)',
                            width: 2
                        }
                    },
                    {
                        // È¢ÑÊµã‰ª∑Ê†ºÔºàËôöÁ∫øÔºâ
                        name: 'È¢ÑÊµã‰ª∑Ê†º',
                        type: 'line',
                        smooth: true,
                        showSymbol: false,
                        data: predictedPrices,
                        yAxisIndex: 0,
                        lineStyle: {
                            color: 'rgba(0,122,255,0.6)',
                            width: 2,
                            type: 'dashed'
                        }
                    },
                    {
                        // SOC (State of Charge) - Âè≥‰æßYËΩ¥
                        name: 'SOC',
                        type: 'line',
                        smooth: true,
                        showSymbol: false,
                        data: socData,
                        yAxisIndex: 1,
                        lineStyle: {
                            color: 'rgba(138, 43, 226, 0.8)',
                            width: 2
                        }
                    },
                    {
                        // Êô∫ËÉΩÂÖÖÁîµÊìç‰ΩúÊ†áËÆ∞ÔºàÁã¨Á´ãÁ≥ªÂàóÔºåÂèØÈÄöËøáÂõæ‰æãÊéßÂà∂Ôºâ
                        name: 'Êô∫ËÉΩÂÖÖÁîµ',
                        type: 'line',
                        data: [],  // Á©∫Êï∞ÊçÆÔºå‰∏çÊòæÁ§∫Á∫øÊù°
                        yAxisIndex: 0,
                        showSymbol: false,
                        legendHoverLink: false,
                        silent: true,
                        animation: false,
                        lineStyle: {
                            color: '#00ff88',  // Êô∫ËÉΩÂÖÖÁîµÔºöÁªøËâ≤
                            width: 2
                        },
                        markArea: {
                            silent: true,
                            data: autoChargeMarkAreaData
                        },
                        markPoint: {
                            silent: true,
                            data: autoChargeMarkPointData,
                            animation: true
                        }
                    },
                    {
                        // Êô∫ËÉΩÊîæÁîµÊìç‰ΩúÊ†áËÆ∞ÔºàÁã¨Á´ãÁ≥ªÂàóÔºåÂèØÈÄöËøáÂõæ‰æãÊéßÂà∂Ôºâ
                        name: 'Êô∫ËÉΩÊîæÁîµ',
                        type: 'line',
                        data: [],  // Á©∫Êï∞ÊçÆÔºå‰∏çÊòæÁ§∫Á∫øÊù°
                        yAxisIndex: 0,
                        showSymbol: false,
                        legendHoverLink: false,
                        silent: true,
                        animation: false,
                        lineStyle: {
                            color: '#FFD60A',  // Êô∫ËÉΩÊîæÁîµÔºöÈªÑËâ≤
                            width: 2
                        },
                        markArea: {
                            silent: true,
                            data: autoDischargeMarkAreaData
                        },
                        markPoint: {
                            silent: true,
                            data: autoDischargeMarkPointData,
                            animation: true
                        }
                    },
                    {
                        // ‰∫∫Â∑•ÂÖÖÁîµÊìç‰ΩúÊ†áËÆ∞ÔºàÁã¨Á´ãÁ≥ªÂàóÔºåÂèØÈÄöËøáÂõæ‰æãÊéßÂà∂Ôºâ
                        name: '‰∫∫Â∑•ÂÖÖÁîµ',
                        type: 'line',
                        data: [],  // Á©∫Êï∞ÊçÆÔºå‰∏çÊòæÁ§∫Á∫øÊù°
                        yAxisIndex: 0,
                        showSymbol: false,
                        legendHoverLink: false,
                        silent: true,
                        animation: false,
                        lineStyle: {
                            color: '#FFB84D',  // ‰∫∫Â∑•ÂÖÖÁîµÔºöÊ©ôËâ≤
                            width: 2
                        },
                        markArea: {
                            silent: true,
                            data: manualChargeMarkAreaData
                        },
                        markPoint: {
                            silent: true,
                            data: manualChargeMarkPointData,
                            animation: true
                        }
                    },
                    {
                        // ‰∫∫Â∑•ÊîæÁîµÊìç‰ΩúÊ†áËÆ∞ÔºàÁã¨Á´ãÁ≥ªÂàóÔºåÂèØÈÄöËøáÂõæ‰æãÊéßÂà∂Ôºâ
                        name: '‰∫∫Â∑•ÊîæÁîµ',
                        type: 'line',
                        data: [],  // Á©∫Êï∞ÊçÆÔºå‰∏çÊòæÁ§∫Á∫øÊù°
                        yAxisIndex: 0,
                        showSymbol: false,
                        legendHoverLink: false,
                        silent: true,
                        animation: false,
                        lineStyle: {
                            color: '#FF6B6B',  // ‰∫∫Â∑•ÊîæÁîµÔºöÁ∫¢Ëâ≤
                            width: 2
                        },
                        markArea: {
                            silent: true,
                            data: manualDischargeMarkAreaData
                        },
                        markPoint: {
                            silent: true,
                            data: manualDischargeMarkPointData,
                            animation: true
                        }
                    },
                    {
                        // ‰∫∫Â∑•/Êô∫ËÉΩÊ†áËÆ∞ÔºàÊòæÁ§∫Êìç‰ΩúÊù•Ê∫êÔºâ
                        name: 'Ë∞ÉÂ∫¶Á±ªÂûã',
                        type: 'line',
                        data: [],  // Á©∫Êï∞ÊçÆÔºå‰∏çÊòæÁ§∫Á∫øÊù°
                        yAxisIndex: 1,  // ‰ΩøÁî®Âè≥‰æß SOC ËΩ¥ÔºåËÆ©Ê†áËÆ∞Ë∑üÈöè SOC Êõ≤Á∫ø
                        showSymbol: false,
                        legendHoverLink: false,
                        silent: false,
                        animation: true,
                        lineStyle: {
                            color: 'transparent',
                            width: 0
                        },
                        markPoint: {
                            silent: false,
                            data: autoMarkPointData,
                            animation: true
                        }
                    }
                ],
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.95)',
                    borderColor: 'rgba(0, 255, 136, 0.3)',
                    borderWidth: 1,
                    borderRadius: 8,
                    padding: [10, 14],
                    textStyle: {
                        color: '#fff',
                        fontSize: 12,
                        fontWeight: 500
                    },
                    extraCssText: 'backdrop-filter: blur(20px);',
                    axisPointer: {
                        type: 'line',
                        lineStyle: {
                            color: 'rgba(0, 255, 136, 0.3)',
                            width: 1,
                            type: 'dashed'
                        }
                    },
                    formatter: function(params) {
                        if (!params || params.length === 0) return '';
                        const timeLabel = params[0].axisValue;
                        let result = `<div style="font-weight: 600; color: #00ff88; margin-bottom: 6px;">Êó∂Èó¥: ${timeLabel}</div>`;

                        params.forEach(item => {
                            if (item.seriesName === 'ÂÆûÈôÖ‰ª∑Ê†º') {
                                result += `<div style="margin-top: 4px; color: rgba(255,255,255,0.8);">
                                    ÂÆûÈôÖ‰ª∑Ê†º: <span style="color: #00ff88; font-weight: 600;">$${item.value}</span>
                                </div>`;
                            } else if (item.seriesName === 'È¢ÑÊµã‰ª∑Ê†º') {
                                result += `<div style="margin-top: 4px; color: rgba(255,255,255,0.8);">
                                    È¢ÑÊµã‰ª∑Ê†º: <span style="color: #007aff; font-weight: 600;">$${item.value}</span>
                                </div>`;
                            } else if (item.seriesName === 'SOC') {
                                result += `<div style="margin-top: 4px; color: rgba(255,255,255,0.8);">
                                    SOC: <span style="color: rgba(138, 43, 226, 0.9); font-weight: 600;">${item.value}%</span>
                                </div>`;
                            }
                        });

                        // ÊòæÁ§∫ËØ•Êó∂Èó¥ÁÇπÂØπÂ∫îÂ∞èÊó∂ÁöÑÊìç‰Ωú
                        const timeIdx = timeLabels.indexOf(timeLabel);
                        if (timeIdx >= 0) {
                            const currentHour = Math.floor(timeIdx / 12); // ËΩ¨Êç¢‰∏∫Â∞èÊó∂
                            const ops = operationsData.filter(op => op.hour === currentHour);
                            if (ops.length > 0) {
                                result += `<div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid rgba(255,255,255,0.1);">`;
                                ops.forEach(op => {
                                    const color = op.command === 'charge' ? '#00ff88' : '#FFD60A';
                                    const text = op.command === 'charge' ? 'ÂÖÖÁîµ' : 'ÊîæÁîµ';
                                    result += `<div style="margin-top: 3px; color: ${color};">‚óè ${text} (${op.power}MW)</div>`;
                                });
                                result += `</div>`;
                            }
                        }

                        return result;
                    }
                }
            };

            chart.setOption(option, true);

            // Responsive resize
            window.addEventListener('resize', () => {
                chart && chart.resize();
            });
        }

        // ========== Render 24 Hour Timeline ==========
        function renderDayTimeline() {
            const timelineDom = document.getElementById('dayTimeline');
            const timelineChart = echarts.init(timelineDom, 'dark');

            // ËØÜÂà´Êô∫ËÉΩÊâòÁÆ°Êó∂ÊÆµ
            const sortedOps = operationsData.filter(op => op.isAuto).sort((a, b) => a.hour - b.hour);
            const custodyPeriods = [];

            // Âú® automated Ê®°Âºè‰∏ãÔºåÊô∫ËÉΩÊâòÁÆ°ÊòæÁ§∫‰∏∫ÂÖ®Â§©ÂºÄÂêØ
            if (operationMode === 'automated' && sortedOps.length > 0) {
                // ÂÖ®Â§©ÂºÄÂêØÔºö0:00 Âà∞ 24:00
                custodyPeriods.push({
                    opStart: 0,
                    opEnd: 24,
                    custodyStart: 0,
                    custodyEnd: 24
                });
            } else if (sortedOps.length > 0) {
                // ÂÖ∂‰ªñÊ®°ÂºèÔºàmanual, hybridÔºâÔºöÊ†πÊçÆÂÆûÈôÖÊô∫ËÉΩÊìç‰ΩúÊó∂ÊÆµÊòæÁ§∫
                let start = sortedOps[0].hour;
                let end = sortedOps[0].hour;

                for (let i = 1; i < sortedOps.length; i++) {
                    if (sortedOps[i].hour === end + 1) {
                        // ËøûÁª≠Êó∂ÊÆµ
                        end = sortedOps[i].hour;
                    } else {
                        // ‰∏çËøûÁª≠Ôºå‰øùÂ≠òÂΩìÂâçÊó∂ÊÆµÔºàÊìç‰ΩúÊó∂ÊÆµÔºâ
                        custodyPeriods.push({
                            opStart: start,
                            opEnd: end + 1,
                            // ÊâòÁÆ°ÂºÄÂêØÊèêÂâç20-40ÂàÜÈíüÔºåÂÖ≥Èó≠Âª∂Âêé10-20ÂàÜÈíü
                            custodyStart: start - 0.5,  // ÊèêÂâç30ÂàÜÈíüÂ∑¶Âè≥
                            custodyEnd: end + 1 + 0.25  // Âª∂Âêé15ÂàÜÈíüÂ∑¶Âè≥
                        });
                        start = sortedOps[i].hour;
                        end = sortedOps[i].hour;
                    }
                }
                // ‰øùÂ≠òÊúÄÂêé‰∏Ä‰∏™Êó∂ÊÆµ
                custodyPeriods.push({
                    opStart: start,
                    opEnd: end + 1,
                    custodyStart: start - 0.5,
                    custodyEnd: end + 1 + 0.25
                });
            }

            // ÁîüÊàê24Â∞èÊó∂ÊØè15ÂàÜÈíüÁöÑÊó∂Èó¥ÁÇπÔºà96‰∏™ÁÇπÔºâ
            const timePoints = [];
            for (let h = 0; h < 24; h++) {
                for (let m = 0; m < 60; m += 15) {
                    timePoints.push({
                        hour: h + m/60,
                        label: `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`
                    });
                }
            }

            // ÁîüÊàêÁä∂ÊÄÅÊï∞ÊçÆÔºà0=ÂÖ≥Èó≠Ôºå1=ÂºÄÂêØÔºâ
            const custodyStatus = timePoints.map(tp => {
                return custodyPeriods.some(p => {
                    // Â§ÑÁêÜË∑®Ë∂äÂçàÂ§úÁöÑÊÉÖÂÜµ
                    if (p.custodyStart < 0) {
                        // Ë∑®Ë∂äÂçàÂ§úÔºöÊØîÂ¶Ç 23:30(-0.5) Âà∞ 02:15(2.25)
                        // Âà§Êñ≠ÊòØÂê¶Âú®23:30-24:00Êàñ0:00-02:15‰πãÈó¥
                        return (tp.hour >= (p.custodyStart + 24) || tp.hour < p.custodyEnd);
                    } else {
                        // Ê≠£Â∏∏ÊÉÖÂÜµ
                        return tp.hour >= p.custodyStart && tp.hour < p.custodyEnd;
                    }
                }) ? 1 : 0;
            });

            // ÊûÑÈÄ†ÊâòÁÆ°Êó∂ÊÆµÁöÑmarkAreaÊï∞ÊçÆÔºàÊòæÁ§∫ÊâòÁÆ°Êó∂ÊÆµÔºâ- Á≤æÁ°ÆÂà∞ÂàÜÈíü
            const custodyMarkArea = [];
            custodyPeriods.forEach(period => {
                // ËÆ°ÁÆóÂºÄÂßãÊó∂Èó¥ÔºàÁ≤æÁ°ÆÂà∞ÂàÜÈíüÔºâ
                let startTime = period.custodyStart;
                if (startTime < 0) startTime += 24;
                const startHour = Math.floor(startTime);
                const startMinute = Math.round((startTime - startHour) * 60);
                const startTimeStr = `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`;

                // ËÆ°ÁÆóÁªìÊùüÊó∂Èó¥ÔºàÁ≤æÁ°ÆÂà∞ÂàÜÈíüÔºâ
                let endTime = period.custodyEnd;
                // Â¶ÇÊûúÊòØ24:00ÔºåÊòæÁ§∫‰∏∫23:45ÔºàÊó∂Èó¥ËΩ¥ÁöÑÊúÄÂêé‰∏Ä‰∏™ÁÇπÔºâ
                if (endTime >= 24) endTime = 23.75; // 23:45
                const endHour = Math.floor(endTime);
                const endMinute = Math.round((endTime - endHour) * 60);
                const endTimeStr = `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`;

                if (period.custodyStart < 0) {
                    // Ë∑®Ë∂äÂçàÂ§úÔºåÂàÜÊàê‰∏§ÊÆµ
                    custodyMarkArea.push([
                        { xAxis: startTimeStr },
                        { xAxis: '23:45' }
                    ]);
                    custodyMarkArea.push([
                        { xAxis: '00:00' },
                        { xAxis: endTimeStr }
                    ]);
                } else {
                    // Ê≠£Â∏∏ÊÉÖÂÜµ
                    custodyMarkArea.push([
                        { xAxis: startTimeStr },
                        { xAxis: endTimeStr }
                    ]);
                }
            });

            // ÊûÑÈÄ†ÂºÄÂêØ/ÂÖ≥Èó≠Ê†áËÆ∞ÁÇπÔºà‰ΩøÁî®ÂÆûÈôÖÁöÑÊâòÁÆ°Êó∂Èó¥ÔºåÊîØÊåÅÂ∞èÊï∞Ôºâ
            const custodyMarkPoint = [];
            custodyPeriods.forEach(period => {
                // ËÆ°ÁÆóÂºÄÂêØÊó∂Èó¥ÔºàÂ§ÑÁêÜË¥üÊï∞ÊÉÖÂÜµÔºâ
                let startTime = period.custodyStart;
                if (startTime < 0) startTime += 24; // Ë∑®Ë∂äÂçàÂ§úÔºåËΩ¨Êç¢‰∏∫Ââç‰∏ÄÂ§©ÁöÑÊó∂Èó¥
                const startHour = Math.floor(startTime);
                const startMinute = Math.round((startTime - startHour) * 60);
                const startTimeStr = `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`;

                // ËÆ°ÁÆóÂÖ≥Èó≠Êó∂Èó¥
                let endTime = period.custodyEnd;
                // Â¶ÇÊûúÊòØ24:00ÔºåÊòæÁ§∫‰∏∫23:59
                if (endTime >= 24) endTime = 23.98333; // 23:59
                const endHour = Math.floor(endTime);
                const endMinute = Math.round((endTime - endHour) * 60);
                const endTimeStr = `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`;

                // ÂºÄÂêØÊ†áËÆ∞
                custodyMarkPoint.push({
                    xAxis: startTimeStr,
                    yAxis: 0.5,
                    symbol: 'circle',
                    symbolSize: 20,
                    itemStyle: {
                        color: 'rgba(0, 255, 136, 0.9)',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: 'ÂºÄ',
                        fontSize: 11,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });

                // ÂÖ≥Èó≠Ê†áËÆ∞ - Âú®Êó∂ÊÆµÁªìÊùü‰ΩçÁΩÆÊòæÁ§∫
                custodyMarkPoint.push({
                    xAxis: endTimeStr,
                    yAxis: 0.5,
                    symbol: 'circle',
                    symbolSize: 20,
                    itemStyle: {
                        color: 'rgba(255, 69, 58, 0.9)',
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: 'ÂÖ≥',
                        fontSize: 11,
                        fontWeight: 700,
                        color: '#fff',
                        offset: [0, 0]
                    }
                });
            });

            const option = {
                backgroundColor: 'transparent',
                grid: {
                    left: 50,
                    right: 50,
                    top: 20,
                    bottom: 30,
                    containLabel: true,
                    backgroundColor: 'rgba(40, 40, 40, 0.3)',  // Ê∑±Ëâ≤ËÉåÊôØÔºåËÆ©ÁÅ∞Ëâ≤Áü©ÂΩ¢Êõ¥ÊòéÊòæ
                    borderColor: 'rgba(80, 80, 80, 0.4)',
                    borderWidth: 1
                },
                xAxis: {
                    type: 'category',
                    data: timePoints.map(tp => tp.label),
                    axisLine: {
                        show: false
                    },
                    axisTick: {
                        show: false
                    },
                    axisLabel: {
                        color: 'rgba(160,160,160,0.6)',
                        fontSize: 11,
                        fontWeight: 500,
                        interval: function(index) {
                            // Âè™ÊòæÁ§∫Êï¥ÁÇπÊ†áÁ≠æ
                            return index % 4 === 0;
                        }
                    },
                    splitLine: {
                        show: false
                    }
                },
                yAxis: {
                    type: 'value',
                    show: false,
                    min: 0,
                    max: 1
                },
                series: [
                    {
                        // ÁÅ∞Ëâ≤ËÉåÊôØÔºàÂÆåÊï¥Áü©ÂΩ¢Ôºâ
                        name: 'ÊâòÁÆ°Âü∫ÂáÜ',
                        type: 'line',
                        data: [],
                        showSymbol: false,
                        lineStyle: { width: 0 },
                        silent: true,
                        markArea: {
                            silent: true,
                            itemStyle: {
                                color: 'rgba(120, 120, 120, 0.5)',  // ÁÅ∞Ëâ≤ËÉåÊôØ
                                borderRadius: 4
                            },
                            data: [[
                                { xAxis: '00:00' },
                                { xAxis: '23:45' }
                            ]],
                            z: 1
                        }
                    },
                    {
                        // ÁªøËâ≤ÂºÄÂêØÊó∂ÊÆµÔºàË¶ÜÁõñÂú®ÁÅ∞Ëâ≤‰∏äÔºâ
                        name: 'Êô∫ËÉΩÊâòÁÆ°Áä∂ÊÄÅ',
                        type: 'line',
                        data: custodyStatus,  // Ê∑ªÂä†Êï∞ÊçÆÁî®‰∫étooltip
                        showSymbol: false,
                        lineStyle: {
                            width: 0,
                            color: 'transparent'  // ÈÄèÊòéÁ∫øÊù°
                        },
                        markArea: {
                            silent: true,
                            itemStyle: {
                                color: 'rgba(0, 255, 136, 0.7)',  // ‰∫ÆÁªøËâ≤
                                borderRadius: 4
                            },
                            data: custodyMarkArea,
                            z: 2
                        },
                        markPoint: {
                            silent: false,
                            data: custodyMarkPoint,
                            animation: true,
                            z: 3
                        }
                    }
                ],
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.9)',
                    borderColor: 'rgba(120, 120, 120, 0.5)',
                    borderWidth: 1,
                    textStyle: { color: '#fff', fontSize: 12 },
                    formatter: (params) => {
                        // ÊâæÂà∞ÊúâÊï∞ÊçÆÁöÑseriesÔºàÊô∫ËÉΩÊâòÁÆ°Áä∂ÊÄÅÔºâ
                        const dataParam = params.find(p => p.seriesName === 'Êô∫ËÉΩÊâòÁÆ°Áä∂ÊÄÅ');
                        if (!dataParam) return '';

                        const time = dataParam.name;
                        const status = dataParam.value;
                        const statusText = status === 1
                            ? '<span style="color: #00ff88;">üü¢ Êô∫ËÉΩÊâòÁÆ°ÂºÄÂêØ</span>'
                            : '<span style="color: #888;">‚ö´ Êô∫ËÉΩÊâòÁÆ°ÂÖ≥Èó≠</span>';
                        return `<strong>${time}</strong><br/>${statusText}`;
                    }
                }
            };

            timelineChart.setOption(option);

            // Responsive resize
            window.addEventListener('resize', () => {
                timelineChart && timelineChart.resize();
            });
        }



        // ========== Export Data ==========
        function exportData() {
            if (operationsData.length === 0) {
                showToast('error', 'ÂØºÂá∫Â§±Ë¥•', 'Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÊï∞ÊçÆ');
                return;
            }

            const headers = ['Êó∂Èó¥', 'Êåá‰ª§Á±ªÂûã', 'Êù•Ê∫ê', 'ÂäüÁéá(MW)', 'ÊåÅÁª≠Êó∂Èó¥(min)', 'Êìç‰ΩúÂëò', 'ÁªìÊûú'];
            const rows = operationsData.map(op => [
                op.time,
                op.command === 'charge' ? 'ÂÖÖÁîµ' : 'ÊîæÁîµ',
                op.source,
                op.power,
                op.duration,
                op.operator,
                op.result
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(item => `"${item}"`).join(',') + '\n';
            });

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${selectedStation}_${selectedDate}_operations.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('success', 'ÂØºÂá∫ÊàêÂäü', `Â∑≤ÂØºÂá∫ ${operationsData.length} Êù°Êìç‰ΩúËÆ∞ÂΩï`);
        }

        // ========== Toast Notifications ==========
        function showToast(type, title, message, duration = 3000) {
            toastCounter++;
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = `toast-${toastCounter}`;
            toast.innerHTML = `
                <div class="toast-icon">${type === 'success' ? '‚úì' : '‚úï'}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.add('show'));
            setTimeout(() => hideToast(toast.id), duration);
        }

        function hideToast(id) {
            const toast = document.getElementById(id);
            if (toast) {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }
        }

        // ========== Initialize on DOM Ready ==========
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize i18n
            if (window.I18nManager) {
                window.i18n = new I18nManager();
                const savedLang = localStorage.getItem('app_language') || 'zh';
                window.i18n.setLanguage(savedLang);
            }

            // Initialize HeaderNav
            const headerNav = new HeaderNav({
                currentPage: 'operationLog',
                containerId: 'headerContainer'
            });

            // Initialize page content
            initializePage();
        });
    </script>
    <script src="page-transition.js"></script>
</body>
</html>
