<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="stylesheet" href="design-system.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>记录 - AlwaysControl</title>
    <link rel="stylesheet" href="components/common-styles.css">
    <link rel="stylesheet" href="components/drawer-component.css">
    <link rel="stylesheet" href="components/i18n.css">
    <link rel="stylesheet" href="components/notification-center.css">
    <script src="components/drawer-component.js"></script>
    <script src="components/i18n.js"></script>
    <script src="components/simple-message-icon.js"></script>
    <link rel="stylesheet" href="components/header-nav.css">
    <link rel="stylesheet" href="components/standard-layout.css">
    <link rel="stylesheet" href="components/pagination.css">
    <script src="components/header-nav.js"></script>
    <script src="components/user-menu-link.js"></script>
    <script src="components/user-dropdown-simple-new.js"></script>
    <script src="components/pagination.js"></script>
    <style>
        /* Page-specific styles */
        html, body {
            background: var(--color-bg) !important;
            width: 100vw;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            color: var(--color-text);
            font-family: var(--font-sans);
        }
        .container {
            background: var(--color-bg);
            max-width: 1200px;
            height: 100vh;
            margin: 0 auto;
            box-sizing: border-box;
            padding: 20px 24px 40px;
            display: flex;
            flex-direction: column;
        }

        /* Fixed Header Area */
        .fixed-header {
            position: sticky;
            top: 20px;
            background: #000;
            z-index: 100;
            padding-bottom: 0;
            padding-top: 0;
        }

        /* Scrollable Content Area */
        .scrollable-content {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
            padding-top: 10px;
        }
        .card, .glass, .stat-card, .chart-container, .table-container {
            background: var(--color-bg-card);
            color: var(--color-text);
            border-radius: var(--radius);
            box-shadow: var(--color-shadow);
            border: 1.5px solid var(--color-border);
            transition: background 0.3s, color 0.3s, border 0.3s;
        }
        .btn, .export-btn, .search-btn {
            background: var(--color-bg-card);
            color: var(--color-text);
            border: 1.5px solid var(--color-border);
            border-radius: 10px;
            transition: background 0.3s, color 0.3s, border 0.3s;
        }
        .btn-primary {
            background: var(--color-primary);
            color: #fff;
            border: none;
        }
        .btn-primary:hover {
            filter: brightness(1.1);
        }
        .btn-secondary {
            background: transparent;
            color: var(--color-text-secondary);
        }
        .btn-secondary:hover {
            background: var(--color-border);
            color: var(--color-text);
        }
        .data-table th, .data-table td {
            color: var(--color-text);
            border-bottom: 1px solid var(--color-border);
        }
        .data-table th {
            background: var(--color-bg-card);
        }
        .data-table tr:hover td {
            background: var(--color-border);
        }
        .table-header {
            border-bottom: 1px solid var(--color-border);
        }
        .header {
            background: var(--color-bg);
            color: var(--color-text);
            transition: background 0.3s, color 0.3s;
        }
        .header .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
            min-width: 160px;
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }
        .theme-toggle-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-bg-card);
            color: var(--color-text);
            border: 1.5px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: background 0.3s, color 0.3s, border 0.3s;
            box-shadow: var(--color-shadow);
            outline: none;
        }
        .theme-toggle-btn:hover, .theme-toggle-btn:focus {
            background: var(--color-border);
            color: var(--color-primary);
        }
        .user-avatar {
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            color: #fff;
        }
        * {
            transition: background 0.3s, color 0.3s, border 0.3s;
        }

        /* Glass morphism effects */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ff88, #00aaff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #000;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .user-avatar:hover {
            transform: scale(1.1);
        }

        /* Main Container */
        .container {
            max-width: 95%;
            margin: 0 auto;
            padding: 88px var(--page-padding, 24px) 40px;
            min-height: calc(100vh - 200px);
        }

        /* Page Title */
        .page-title {
            font-size: 48px;
            font-weight: 500;
            color: var(--color-text);
            margin: 0;
            letter-spacing: -2px;
            background: none;
            -webkit-text-fill-color: unset;
            margin-bottom: 0 !important;
        }

        /* === Filter Section Styles === */
        .search-filter-section {
            background: var(--color-bg-card);
            border-radius: var(--radius);
            box-shadow: var(--color-shadow);
            border: 1.5px solid var(--color-border);
            padding: 20px;
            margin-bottom: 36px;
        }
        .search-input {
            width: 220px;
            padding: 12px 16px 12px 44px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s;
        }
        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        .filter-select {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        .filter-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(0, 255, 136, 0.5);
        }
        .filter-select option {
            background: #1a1a1a;
            color: #fff;
            padding: 8px;
        }
        .filter-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }
        .filter-btn {
            padding: 10px 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .filter-btn.primary {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 170, 255, 0.2));
            border-color: rgba(0, 255, 136, 0.5);
            color: #fff;
        }
        .filter-btn.primary:hover {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(0, 170, 255, 0.3));
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
        }
        .filter-btn.secondary {
            background: rgba(255, 255, 255, 0.05);
        }
        .filter-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        .filter-btn.export {
            background: rgba(30, 127, 255, 0.1);
            border: 1px solid rgba(30, 127, 255, 0.3);
            color: var(--color-accent);
        }
        .filter-btn.export:hover {
            background: rgba(30, 127, 255, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(30, 127, 255, 0.3);
        }
        .filter-btn.refresh {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #00ff88;
        }
        .filter-btn.refresh:hover {
            background: rgba(0, 255, 136, 0.15);
            border-color: rgba(0, 255, 136, 0.4);
            transform: translateY(-1px);
        }
        @media (max-width: 768px) {
            .search-filter-section {
                flex-direction: column;
            }
        }

        /* Table Card */
        .table-card {
            background: var(--color-bg-card);
            border-radius: var(--radius);
            box-shadow: var(--color-shadow);
            border: 1.5px solid var(--color-border);
            width: 100%;
            margin-bottom: 20px;
            padding: 20px;
        }

        /* Table Actions Header */
        .table-actions-header {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
        }

        /* Table Wrapper */
        .table-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius);
            border: 1px solid var(--color-border);
        }

        /* Scrollable container */
        .table-scrollable {
            overflow-x: auto;
            width: 100%;
            position: relative;
        }

        /* Custom scrollbar */
        .table-scrollable::-webkit-scrollbar {
            height: 8px;
        }
        .table-scrollable::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }
        .table-scrollable::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
        }
        .table-scrollable::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Fixed action column */
        .data-table th:last-child,
        .data-table td:last-child {
            position: sticky;
            right: 0;
            background: #000000;
            z-index: 2;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.3);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }
        .data-table th:last-child {
            background: #0a0a0a;
        }
        .data-table tbody tr:hover td:last-child {
            background: #111111;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }
        .data-table th {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px 18px;
            text-align: left;
            font-size: 13px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            white-space: nowrap;
        }
        .data-table td {
            padding: 16px 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            vertical-align: middle;
        }
        .data-table tbody tr {
            transition: all 0.2s ease;
        }
        .data-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Command Badges */
        .operation-command {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
            border: 1px solid;
        }
        .command-charge {
            background: rgba(52, 199, 89, 0.15);
            color: #34c759;
            border-color: rgba(52, 199, 89, 0.3);
        }
        .command-discharge {
            background: rgba(0, 122, 255, 0.15);
            color: #007aff;
            border-color: rgba(0, 122, 255, 0.3);
        }
        .command-icon {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            box-shadow: 0 0 4px currentColor;
        }

        /* Source Badges */
        .source-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid;
        }
        .source-aemo {
            background: rgba(255, 149, 0, 0.15);
            color: #ff9500;
            border-color: rgba(255, 149, 0, 0.3);
        }
        .source-ems {
            background: rgba(0, 122, 255, 0.15);
            color: #007aff;
            border-color: rgba(0, 122, 255, 0.3);
        }
        .source-manual {
            background: rgba(88, 86, 214, 0.15);
            color: #5856d6;
            border-color: rgba(88, 86, 214, 0.3);
        }
        .source-vpp {
            background: rgba(90, 200, 250, 0.15);
            color: #5ac8fa;
            border-color: rgba(90, 200, 250, 0.3);
        }

        /* Result Badges */
        .result-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }
        .result-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }
        .result-success {
            background: rgba(0, 255, 136, 0.15);
            color: #00ff88;
        }
        .result-completed {
            background: rgba(52, 199, 89, 0.15);
            color: #34c759;
        }
        .result-partial {
            background: rgba(255, 204, 0, 0.15);
            color: #ffcc00;
        }
        .result-failed {
            background: rgba(255, 59, 48, 0.15);
            color: #ff3b30;
        }

        /* Action Link */
        .action-link {
            color: #00ff88;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 10px;
            transition: all 0.2s ease;
            border: 1px solid rgba(0, 255, 136, 0.3);
            background: rgba(0, 255, 136, 0.05);
            display: inline-block;
        }
        .action-link:hover {
            background: rgba(0, 255, 136, 0.15);
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
            transform: translateY(-1px);
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        /* Task Status Badges */
        .status-running {
            background: rgba(0, 122, 255, 0.15);
            color: #007aff;
            border: 1px solid rgba(0, 122, 255, 0.3);
        }
        .status-running::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }
        .status-success {
            background: rgba(52, 199, 89, 0.15);
            color: #34c759;
            border: 1px solid rgba(52, 199, 89, 0.3);
        }
        .status-pending {
            background: rgba(255, 149, 0, 0.15);
            color: #ff9500;
            border: 1px solid rgba(255, 149, 0, 0.3);
        }
        .status-cancelled {
            background: rgba(255, 59, 48, 0.15);
            color: #ff3b30;
            border: 1px solid rgba(255, 59, 48, 0.3);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Pagination */
        .pagination-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.02);
        }
        .pagination-info {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }
        .page-size-select {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.8);
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        .page-size-select:focus {
            border-color: rgba(0, 255, 136, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }
        .page-size-select option {
            background: #1a1a1a;
            color: #fff;
        }
        .pagination-buttons {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .page-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.7);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }
        .page-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-color: rgba(255, 255, 255, 0.2);
        }
        .page-btn.active {
            background: linear-gradient(135deg, #00ff88, #00aaff);
            color: #000;
            border-color: #00ff88;
            font-weight: 600;
        }
        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .page-jump {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }
        .page-input {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.8);
            width: 50px;
            height: 32px;
            text-align: center;
            font-size: 13px;
            outline: none;
            transition: all 0.3s ease;
        }
        .page-input:focus {
            border-color: rgba(0, 255, 136, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }
        .page-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 30px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }
        .toast {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            min-width: 320px;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: auto;
            position: relative;
            overflow: hidden;
        }
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            flex-shrink: 0;
        }
        .toast.success .toast-icon {
            background: #34c759;
            color: #000;
        }
        .toast.error .toast-icon {
            background: #ff3b30;
            color: #fff;
        }
        .toast.info .toast-icon {
            background: #007aff;
            color: #fff;
        }
        .toast-content {
            flex: 1;
        }
        .toast-title {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }
        .toast-message {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }
        .toast-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .toast-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                padding: 88px var(--page-padding, 24px) 40px;
            }
        }
        @media (max-width: 768px) {
            .container {
                padding: 88px var(--page-padding, 24px) 40px;
            }
            .pagination-section {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            .pagination-controls {
                justify-content: center;
                flex-wrap: wrap;
            }
            .page-btn {
                width: 32px;
                height: 32px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Container for HeaderNav Component -->
    <div id="headerContainer"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Fixed Header Area -->
        <div class="fixed-header">
            <!-- Page Title -->
            <h1 class="page-title" data-i18n="operationLog.title">调度记录</h1>

            <!-- Filter Bar -->
            <div class="search-filter-section" style="display: flex; flex-wrap: wrap; align-items: center; gap: 12px; margin-top: 16px; margin-bottom: 16px; padding: 20px; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; backdrop-filter: blur(10px);">
                <select id="stationFilter" class="filter-select"
                        style="padding: 12px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">
                    <option value="" data-i18n="operationLog.filter.allStations">全部电站</option>
                </select>

                <select class="filter-select" id="opCommandFilter"
                        style="padding: 12px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">
                    <option value="" data-i18n="operationLog.filter.allCommands">全部指令</option>
                    <option value="charge" data-i18n="operationLog.filter.charge">充电</option>
                    <option value="discharge" data-i18n="operationLog.filter.discharge">放电</option>
                </select>

                <input type="text" class="search-input" id="opDateInput"
                       style="width: 160px; padding: 12px 16px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 10px; color: rgba(255, 255, 255, 0.9); font-size: 14px; cursor: pointer;"
                       data-i18n-placeholder="operationLog.filter.timePlaceholder"
                       placeholder="请选择时间..."
                       readonly>

                <div class="filter-actions" style="display: flex; gap: 8px; margin-left: auto;">
                    <button class="filter-btn primary" onclick="applyOpFilters()"
                            style="background: #00ff88; border-color: #00ff88; color: #000; font-weight: 500;">
                        <span data-i18n="operationLog.buttons.search">查询</span>
                    </button>
                    <button class="filter-btn secondary" onclick="resetOpFilters()"
                            style="background: rgba(255, 255, 255, 0.05);">
                        <span data-i18n="operationLog.buttons.reset">重置</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Station Daily Statistics Table -->
        <div class="scrollable-content">
            <div class="table-card" style="margin-bottom: 32px;">
                <div class="table-actions-header">
                    <h3 style="font-size: 18px; font-weight: 600; color: var(--color-text); margin: 0;">
                        <span data-i18n="operationLog.dailyStats.title">每日电站统计</span>
                    </h3>
                </div>

                <div class="table-wrapper">
                    <div class="table-scrollable">
                        <table class="data-table" id="dailyStatsTable">
                            <thead>
                                <tr>
                                    <th data-i18n="operationLog.dailyStats.date" onclick="sortStatsTable('date')" style="cursor: pointer;">日期 <span id="sort-date"></span></th>
                                    <th data-i18n="operationLog.dailyStats.station" onclick="sortStatsTable('station')" style="cursor: pointer;">电站 <span id="sort-station"></span></th>
                                    <th data-i18n="operationLog.dailyStats.chargeCount" onclick="sortStatsTable('chargeCount')" style="cursor: pointer;">充电次数 <span id="sort-chargeCount"></span></th>
                                    <th data-i18n="operationLog.dailyStats.dischargeCount" onclick="sortStatsTable('dischargeCount')" style="cursor: pointer;">放电次数 <span id="sort-dischargeCount"></span></th>
                                    <th data-i18n="operationLog.dailyStats.operationMode" onclick="sortStatsTable('operationMode')" style="cursor: pointer;">操作方式 <span id="sort-operationMode"></span></th>
                                    <th data-i18n="operationLog.table.action">操作</th>
                                </tr>
                            </thead>
                            <tbody id="dailyStatsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="statsPaginationContainer"></div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ========== Global Variables ==========
        let toastCounter = 0;
        let filteredData = [];

        // Statistics table variables
        let statsCurrentPage = 1;
        let statsPageSize = 10;
        let dailyStatsData = [];
        let statsPagination = null;
        let currentSortColumn = null;
        let currentSortDirection = 'asc'; // 'asc' or 'desc'

        // ========== Operator i18n ==========
        const operatorsCN = ['李怡悦', '王乐康', '张三', '李四', '王五', '赵六', '孙七', '周八', '系统自动'];
        const operatorsEN = ['Yiyue Li', 'Lekang Wang', 'John Zhang', 'Mike Li', 'David Wang', 'Lucy Zhao', 'Tom Sun', 'Emily Zhou', 'System Auto'];

        function getOperatorName(cnName) {
            const index = operatorsCN.indexOf(cnName);
            if (window.i18n && window.i18n.getCurrentLanguage() === 'en' && index !== -1) {
                return operatorsEN[index];
            }
            return cnName;
        }

        // ========== Weighted Random ==========
        function weightedRandomIndex(weights) {
            const total = weights.reduce((a, b) => a + b, 0);
            let r = Math.random() * total;
            for (let i = 0; i < weights.length; i++) {
                r -= weights[i];
                if (r <= 0) return i;
            }
            return weights.length - 1;
        }

        // ========== Mock Data Generation ==========
        const commands = ['charge', 'discharge'];
        const sources = ['AEMO', 'EMS', 'Manual', 'VPP'];
        const results = ['success', 'completed', 'partial', 'failed'];
        const resultWeights = [0.5, 0.3, 0.12, 0.08];
        const regions = ['NSW', 'QLD', 'VIC', 'SA', 'TAS'];
        const stationList = [
            'Hornsdale Power Reserve', 'Victorian Big Battery', 'Wallgrove BESS',
            'Wandoan South BESS', 'Bouldercombe BESS', 'Torrens Island BESS',
            'Waratah Super Battery', 'Capital Battery', 'Lake Bonney BESS',
            'Broken Hill BESS', 'Hazelwood BESS', 'Moorabool BESS'
        ];

        const allDispatchRecords = [];

        // 15 hand-crafted records
        const seedRecords = [
            { id: 1, time: '2024-02-17 06:25', command: 'charge', source: 'EMS', region: 'NSW', stationName: 'Wallgrove BESS', power: 25.5, duration: 30, operator: '李怡悦', result: 'success', processed: false },
            { id: 2, time: '2024-02-17 07:01', command: 'charge', source: 'Manual', region: 'NSW', stationName: 'Waratah Super Battery', power: 18.0, duration: 25, operator: '王乐康', result: 'completed', processed: false },
            { id: 3, time: '2024-02-17 14:10', command: 'discharge', source: 'AEMO', region: 'NSW', stationName: 'Broken Hill BESS', power: 42.0, duration: 8, operator: '系统自动', result: 'success', processed: false },
            { id: 4, time: '2024-02-17 18:00', command: 'discharge', source: 'EMS', region: 'QLD', stationName: 'Wandoan South BESS', power: 35.2, duration: 45, operator: '李怡悦', result: 'success', processed: true },
            { id: 5, time: '2024-02-17 20:35', command: 'charge', source: 'VPP', region: 'QLD', stationName: 'Bouldercombe BESS', power: 18.8, duration: 20, operator: '系统自动', result: 'completed', processed: true },
            { id: 6, time: '2024-02-17 23:07', command: 'discharge', source: 'Manual', region: 'QLD', stationName: 'Wandoan South BESS', power: 30.0, duration: 35, operator: '王乐康', result: 'success', processed: false },
            { id: 7, time: '2024-02-16 09:15', command: 'charge', source: 'AEMO', region: 'VIC', stationName: 'Victorian Big Battery', power: 30.0, duration: 55, operator: '张三', result: 'completed', processed: true },
            { id: 8, time: '2024-02-16 14:30', command: 'charge', source: 'EMS', region: 'VIC', stationName: 'Hazelwood BESS', power: 22.3, duration: 40, operator: '张三', result: 'partial', processed: false },
            { id: 9, time: '2024-02-16 16:45', command: 'discharge', source: 'VPP', region: 'VIC', stationName: 'Moorabool BESS', power: 28.7, duration: 35, operator: '李四', result: 'success', processed: true },
            { id: 10, time: '2024-02-16 20:15', command: 'discharge', source: 'Manual', region: 'SA', stationName: 'Torrens Island BESS', power: 40.5, duration: 30, operator: '王五', result: 'success', processed: true },
            { id: 11, time: '2024-02-15 09:20', command: 'charge', source: 'EMS', region: 'SA', stationName: 'Hornsdale Power Reserve', power: 15.0, duration: 50, operator: '赵六', result: 'completed', processed: true },
            { id: 12, time: '2024-02-15 11:35', command: 'discharge', source: 'AEMO', region: 'TAS', stationName: 'Capital Battery', power: 38.5, duration: 12, operator: '系统自动', result: 'success', processed: false },
            { id: 13, time: '2024-02-15 15:50', command: 'charge', source: 'VPP', region: 'TAS', stationName: 'Capital Battery', power: 20.1, duration: 25, operator: '系统自动', result: 'partial', processed: false },
            { id: 14, time: '2024-02-15 18:00', command: 'discharge', source: 'AEMO', region: 'NSW', stationName: 'Wallgrove BESS', power: 45.0, duration: 50, operator: '周八', result: 'success', processed: true },
            { id: 15, time: '2024-02-14 10:00', command: 'charge', source: 'EMS', region: 'TAS', stationName: 'Capital Battery', power: 12.0, duration: 30, operator: '孙七', result: 'failed', processed: false }
        ];
        seedRecords.forEach(r => allDispatchRecords.push(r));

        // Generate 305 more random records
        for (let i = 16; i <= 320; i++) {
            const randomDate = new Date(2024, 1, Math.floor(Math.random() * 28) + 1, Math.floor(Math.random() * 24), Math.floor(Math.random() * 60));
            allDispatchRecords.push({
                id: i,
                time: randomDate.toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }).replace(/\//g, '-'),
                command: commands[Math.floor(Math.random() * commands.length)],
                source: sources[Math.floor(Math.random() * sources.length)],
                region: regions[Math.floor(Math.random() * regions.length)],
                stationName: stationList[Math.floor(Math.random() * stationList.length)],
                power: parseFloat((Math.random() * 50 + 1).toFixed(1)),
                duration: Math.floor(5 + Math.random() * 55),
                operator: operatorsCN[Math.floor(Math.random() * (operatorsCN.length - 1))],
                result: results[weightedRandomIndex(resultWeights)],
                processed: Math.random() > 0.4
            });
        }

        allDispatchRecords.sort((a, b) => new Date(b.time) - new Date(a.time));
        filteredData = [...allDispatchRecords];

        // ========== Generate Daily Statistics ==========
        function generateDailyStats(records) {
            // 首先按 date + station 分组收集记录
            const groupedRecords = new Map();

            records.forEach(record => {
                const date = record.time.split(' ')[0];
                const key = `${date}_${record.stationName}`;

                if (!groupedRecords.has(key)) {
                    groupedRecords.set(key, {
                        date: date,
                        station: record.stationName,
                        region: record.region,
                        records: []
                    });
                }

                groupedRecords.get(key).records.push(record);
            });

            // 处理每个分组，识别操作段
            const statsMap = new Map();

            groupedRecords.forEach((group, key) => {
                // 按时间排序
                const sortedRecords = group.records.sort((a, b) => {
                    return new Date(a.time) - new Date(b.time);
                });

                let manualCount = 0;
                let automatedCount = 0;

                // 识别操作模式段：每个不同的（命令类型 + 操作模式）组合算一段
                // 这样可以统计有多少个"智能充电"、"人工充电"、"智能放电"、"人工放电"标记
                const segments = [];
                let currentSegment = null;

                sortedRecords.forEach((record, index) => {
                    // 统计操作模式
                    if (record.source === 'Manual') {
                        manualCount++;
                    } else {
                        automatedCount++;
                    }

                    // 判断操作模式（人工 vs 自动）
                    const isManual = record.source === 'Manual';
                    const command = record.command;

                    // 判断是否需要开启新段
                    let isNewSegment = false;

                    if (!currentSegment) {
                        // 第一条记录，开启新段
                        isNewSegment = true;
                    } else if (currentSegment.command !== command || currentSegment.isManual !== isManual) {
                        // 命令类型或操作模式改变，开启新段
                        isNewSegment = true;
                    } else if (index > 0) {
                        // 同命令同模式，检查时间间隔
                        const prevTime = new Date(sortedRecords[index - 1].time);
                        const currTime = new Date(record.time);
                        const hoursDiff = (currTime - prevTime) / (1000 * 60 * 60);

                        // 时间间隔超过2小时，视为新段
                        if (hoursDiff > 2) {
                            isNewSegment = true;
                        }
                    }

                    if (isNewSegment) {
                        currentSegment = {
                            command: command,
                            isManual: isManual,
                            startTime: record.time
                        };
                        segments.push(currentSegment);
                    }
                });

                // 统计充电和放电的段数（每段对应一个标记）
                const chargeSegments = segments.filter(s => s.command === 'charge').length;
                const dischargeSegments = segments.filter(s => s.command === 'discharge').length;

                statsMap.set(key, {
                    date: group.date,
                    station: group.station,
                    region: group.region,
                    chargeCount: chargeSegments,
                    dischargeCount: dischargeSegments,
                    manualCount: manualCount,
                    automatedCount: automatedCount,
                    totalOperations: sortedRecords.length
                });
            });

            // Convert map to array and add computed fields
            const statsArray = Array.from(statsMap.values()).map(stat => {
                // Determine operation mode
                let operationMode = '';
                let chargeCount = 0;
                let dischargeCount = 0;

                if (stat.manualCount > 0 && stat.automatedCount > 0) {
                    // 混合模式：机器人 + 人工
                    operationMode = 'hybrid';
                    chargeCount = 2;
                    dischargeCount = 2;
                } else if (stat.manualCount > 0) {
                    // 纯人工
                    operationMode = 'manual';
                    chargeCount = 1;
                    dischargeCount = 1;
                } else {
                    // 纯机器人
                    operationMode = 'automated';
                    chargeCount = 1;
                    dischargeCount = 1;
                }

                return {
                    ...stat,
                    operationMode: operationMode,
                    chargeCount: chargeCount,
                    dischargeCount: dischargeCount
                };
            });

            // Sort by date desc, then by station name
            statsArray.sort((a, b) => {
                const dateCompare = b.date.localeCompare(a.date);
                if (dateCompare !== 0) return dateCompare;
                return a.station.localeCompare(b.station);
            });

            return statsArray;
        }

        // Initialize daily stats
        dailyStatsData = generateDailyStats(allDispatchRecords);

        // Populate station filter dropdown
        (function populateStationFilter() {
            const select = document.getElementById('stationFilter');
            const uniqueStations = [...new Set(allDispatchRecords.map(r => r.stationName))].sort();
            uniqueStations.forEach(name => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = name;
                select.appendChild(opt);
            });
        })();

        // ========== Display Info Helpers ==========
        function getCommandInfo(command) {
            const t = (key, fallback) => window.i18n ? window.i18n.getText(key) : fallback;
            const commandMap = {
                'charge':    { text: t('operationLog.commands.charge', '充电'),    class: 'command-charge' },
                'discharge': { text: t('operationLog.commands.discharge', '放电'),  class: 'command-discharge' }
            };
            return commandMap[command] || { text: command, class: 'command-charge' };
        }

        function getSourceInfo(source) {
            const t = (key, fallback) => window.i18n ? window.i18n.getText(key) : fallback;
            const sourceMap = {
                'AEMO':   { text: 'AEMO',                                    class: 'source-aemo' },
                'EMS':    { text: 'EMS',                                      class: 'source-ems' },
                'Manual': { text: t('operationLog.sources.manual', '手动'),    class: 'source-manual' },
                'VPP':    { text: 'VPP',                                      class: 'source-vpp' }
            };
            return sourceMap[source] || { text: source, class: '' };
        }

        function getResultInfo(result) {
            const t = (key, fallback) => window.i18n ? window.i18n.getText(key) : fallback;
            const resultMap = {
                'success':   { text: t('operationLog.results.success', '成功'),     class: 'result-success' },
                'completed': { text: t('operationLog.results.completed', '已完成'),  class: 'result-completed' },
                'partial':   { text: t('operationLog.results.partial', '部分完成'),   class: 'result-partial' },
                'failed':    { text: t('operationLog.results.failed', '失败'),       class: 'result-failed' }
            };
            return resultMap[result] || { text: result, class: '' };
        }

        function getOperationModeText(operationMode) {
            const t = (key, fallback) => window.i18n ? window.i18n.getText(key) : fallback;
            const modeMap = {
                'manual': t('operationLog.dailyStats.modes.manual', '人工'),
                'automated': t('operationLog.dailyStats.modes.automated', '智能托管'),
                'hybrid': t('operationLog.dailyStats.modes.manual', '人工') + ';' + t('operationLog.dailyStats.modes.automated', '智能托管')
            };
            return modeMap[operationMode] || operationMode;
        }

        // ========== Toast Notifications ==========
        function showToast(type, title, message, duration = 3000) {
            toastCounter++;
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = `toast-${toastCounter}`;
            toast.innerHTML = `
                <div class="toast-icon">${type === 'success' ? '✓' : type === 'error' ? '✕' : 'i'}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="hideToast('${toast.id}')">&times;</button>
            `;
            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.add('show'));
            setTimeout(() => hideToast(toast.id), duration);
        }
        function hideToast(id) {
            const toast = document.getElementById(id);
            if (toast) {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }
        }
        function showInfoToast(title, message) { showToast('info', title, message); }
        function showSuccessToast(title, message) { showToast('success', title, message); }
        function showErrorToast(title, message, d = 4000) { showToast('error', title, message, d); }

        // ========== Daily Stats Table Rendering ==========
        function updateStatsTableDisplay() {
            const tbody = document.getElementById('dailyStatsTableBody');
            const startIndex = (statsCurrentPage - 1) * statsPageSize;
            const endIndex = startIndex + statsPageSize;
            const pageData = dailyStatsData.slice(startIndex, endIndex);

            tbody.innerHTML = '';

            if (pageData.length === 0) {
                const t = (k, f) => window.i18n ? window.i18n.getText(k) : f;
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding:40px; color:rgba(255,255,255,0.5);">${t('operationLog.noData', '暂无数据')}</td></tr>`;
                return;
            }

            pageData.forEach(stat => {
                const row = document.createElement('tr');

                // Operation mode badge
                let operationModeClass = '';
                let operationModeText = getOperationModeText(stat.operationMode);

                if (stat.operationMode === 'manual') {
                    operationModeClass = 'background: rgba(88, 86, 214, 0.15); color: #5856d6; border: 1px solid rgba(88, 86, 214, 0.3);';
                } else if (stat.operationMode === 'automated') {
                    operationModeClass = 'background: rgba(0, 122, 255, 0.15); color: #007aff; border: 1px solid rgba(0, 122, 255, 0.3);';
                } else {
                    operationModeClass = 'background: rgba(255, 149, 0, 0.15); color: #ff9500; border: 1px solid rgba(255, 149, 0, 0.3);';
                }

                const t = (k, f) => window.i18n ? window.i18n.getText(k) : f;

                row.innerHTML = `
                    <td style="white-space:nowrap; font-weight: 500;">${stat.date}</td>
                    <td>${stat.station}</td>
                    <td style="text-align: center; color: #34c759; font-weight: 600;">${stat.chargeCount}</td>
                    <td style="text-align: center; color: #FFD60A; font-weight: 600;">${stat.dischargeCount}</td>
                    <td style="text-align: center;"><span class="status-badge" style="${operationModeClass}">${operationModeText}</span></td>
                    <td>
                        <a href="#" class="action-link" style="color: #00ff88;" onclick="viewStationDailyDetails('${stat.date}', '${stat.station}', '${stat.operationMode}'); return false;">详情</a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateStatsPaginationDisplay() {
            if (statsPagination) {
                statsPagination.update({
                    totalItems: dailyStatsData.length,
                    currentPage: statsCurrentPage,
                    pageSize: statsPageSize
                });
            }
        }

        // ========== Sorting Functions ==========
        function sortStatsTable(column) {
            // Toggle sort direction if clicking the same column
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }

            // Sort the data
            dailyStatsData.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                // Handle different data types
                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (valA < valB) {
                    return currentSortDirection === 'asc' ? -1 : 1;
                }
                if (valA > valB) {
                    return currentSortDirection === 'asc' ? 1 : -1;
                }
                return 0;
            });

            // Update sort indicators
            updateSortIndicators();

            // Refresh table display
            updateStatsTableDisplay();
        }

        function updateSortIndicators() {
            // Clear all sort indicators
            const columns = ['date', 'station', 'capacity', 'chargeCount', 'dischargeCount', 'operationMode'];
            columns.forEach(col => {
                const indicator = document.getElementById(`sort-${col}`);
                if (indicator) {
                    indicator.textContent = '';
                }
            });

            // Set current sort indicator
            if (currentSortColumn) {
                const indicator = document.getElementById(`sort-${currentSortColumn}`);
                if (indicator) {
                    indicator.textContent = currentSortDirection === 'asc' ? ' ▲' : ' ▼';
                }
            }
        }

        // ========== Filter Functions ==========
        function applyOpFilters() {
            const station = document.getElementById('stationFilter').value;
            const command = document.getElementById('opCommandFilter').value;
            const date = document.getElementById('opDateInput').value.trim();

            filteredData = allDispatchRecords.filter(record => {
                if (station && record.stationName !== station) return false;
                if (command && record.command !== command) return false;
                if (date && !record.time.startsWith(date)) return false;
                return true;
            });

            // Update daily stats based on filtered data
            dailyStatsData = generateDailyStats(filteredData);
            statsCurrentPage = 1;

            updateStatsTableDisplay();
            updateStatsPaginationDisplay();

            const t = (k, f) => window.i18n ? window.i18n.getText(k) : f;
            showInfoToast(t('operationLog.buttons.search', '查询'), `${filteredData.length} ${t('operationLog.total', '共')} `);
        }

        function resetOpFilters() {
            document.getElementById('stationFilter').selectedIndex = 0;
            document.getElementById('opCommandFilter').selectedIndex = 0;
            document.getElementById('opDateInput').value = '';
            filteredData = [...allDispatchRecords];

            // Reset daily stats
            dailyStatsData = generateDailyStats(allDispatchRecords);
            statsCurrentPage = 1;

            updateStatsTableDisplay();
            updateStatsPaginationDisplay();
        }

        // Realtime search on select change
        function setupOpRealTimeSearch() {
            const selects = ['stationFilter', 'opCommandFilter'];
            selects.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('change', () => applyOpFilters());
            });
        }

        // ========== Export Statistics ==========
        function exportDailyStats() {
            if (!dailyStatsData.length) {
                showErrorToast('导出失败', '没有可导出的统计数据');
                return;
            }
            const t = (k, f) => window.i18n ? window.i18n.getText(k) : f;
            const headers = [
                t('operationLog.dailyStats.date', '日期'),
                t('operationLog.dailyStats.station', '电站'),
                t('operationLog.dailyStats.capacity', '装机容量'),
                t('operationLog.dailyStats.chargeCount', '充电次数'),
                t('operationLog.dailyStats.dischargeCount', '放电次数'),
                t('operationLog.dailyStats.operationMode', '操作方式')
            ];
            const rows = dailyStatsData.map(stat => [
                stat.date,
                stat.station,
                stat.capacity,
                stat.chargeCount,
                stat.dischargeCount,
                getOperationModeText(stat.operationMode)
            ]);
            let csv = headers.join(',') + '\n';
            rows.forEach(row => { csv += row.map(item => `"${item}"`).join(',') + '\n'; });
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daily_station_statistics_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showSuccessToast('导出成功', `已导出 ${dailyStatsData.length} 条统计记录`);
        }

        // ========== View Station Daily Details ==========
        function viewStationDailyDetails(date, stationName, operationMode) {
            // Navigate to station detail page with parameters
            const params = new URLSearchParams({
                date: date,
                station: encodeURIComponent(stationName),
                mode: operationMode || 'hybrid'
            });
            window.location.href = `operation-log-detail.html?${params.toString()}`;
        }

        // ========== Edit Station ==========
        function editStation(date, stationName) {
            showInfoToast('编辑功能', `编辑电站: ${stationName} (${date})`);
            // TODO: 实现编辑功能
        }

        // ========== Delete Station ==========
        function deleteStation(date, stationName) {
            if (confirm(`确定要删除电站 "${stationName}" 在 ${date} 的记录吗？`)) {
                showSuccessToast('删除成功', `已删除电站 ${stationName} 的记录`);
                // TODO: 实现实际的删除逻辑
            }
        }


        // ========== Date Picker for opDateInput ==========
        function setupOpDatePicker() {
            const dateInput = document.getElementById('opDateInput');
            if (!dateInput) return;
            dateInput.addEventListener('click', function(e) {
                e.stopPropagation();
                // Simple date input via prompt (lightweight approach)
                const val = prompt(window.i18n ? window.i18n.getText('operationLog.filter.timePlaceholder') : '请输入日期 (YYYY-MM-DD)', dateInput.value || '2024-02-');
                if (val !== null) {
                    dateInput.value = val;
                    applyOpFilters();
                }
            });
        }

        // ========== Initialization ==========
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize i18n
            if (window.I18nManager) {
                window.i18n = new I18nManager();
                const savedLang = localStorage.getItem('app_language') || 'zh';
                window.i18n.setLanguage(savedLang);
            }

            // Force translate after delay
            setTimeout(() => {
                if (window.i18n && window.i18n.updatePageTexts) {
                    window.i18n.updatePageTexts();
                }
            }, 100);
            setTimeout(() => {
                if (window.i18n && window.i18n.updatePageTexts) {
                    window.i18n.updatePageTexts();
                }
            }, 500);

            // Initialize HeaderNav
            const headerNav = new HeaderNav({
                currentPage: 'operationLog',
                containerId: 'headerContainer'
            });

            // Initialize pagination for statistics table
            statsPagination = new Pagination({
                containerId: 'statsPaginationContainer',
                currentPage: statsCurrentPage,
                pageSize: statsPageSize,
                totalItems: dailyStatsData.length,
                onPageChange: (page, size) => {
                    statsCurrentPage = page;
                    updateStatsTableDisplay();
                },
                onPageSizeChange: (size) => {
                    statsPageSize = size;
                    statsCurrentPage = 1;
                    updateStatsTableDisplay();
                }
            });

            // Initial render
            updateStatsTableDisplay();
            updateStatsPaginationDisplay();

            // Setup realtime search
            setupOpRealTimeSearch();
            setupOpDatePicker();

            // Language change observer
            if (window.i18n) {
                window.i18n.addObserver((newLang, oldLang) => {
                    updateStatsTableDisplay();
                    updateStatsPaginationDisplay();
                });
            }

        });
    </script>
    <script src="components/global-notifications.js"></script>
    <script src="page-transition.js"></script>
</body>
</html>
