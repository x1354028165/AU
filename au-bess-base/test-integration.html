<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½é›†æˆæµ‹è¯• - AU BESS Platform</title>
    <link rel="stylesheet" href="css/design-system.css">
    <script src="js/market-data.js"></script>
    <script src="js/alarm-system.js"></script>
    <style>
        body { padding: 20px; }
        .test-section { 
            margin-bottom: 40px; 
            padding: 20px; 
            border: 2px solid var(--color-border); 
            border-radius: var(--radius);
        }
        .test-result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: var(--radius-sm); 
            font-family: monospace; 
        }
        .test-success { background: rgba(52, 199, 89, 0.1); color: #34c759; }
        .test-error { background: rgba(255, 59, 48, 0.1); color: #ff3b30; }
        .feature-demo { 
            margin: 20px 0; 
            padding: 15px; 
            background: var(--color-bg-card); 
            border-radius: var(--radius); 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="page-title">æ¾³æ´²å‚¨èƒ½ç”µç«™å¹³å° - åŠŸèƒ½é›†æˆæµ‹è¯•</h1>
        
        <!-- è®¾è®¡ç³»ç»Ÿæµ‹è¯• -->
        <div class="test-section">
            <h2 class="section-title">1. è®¾è®¡ç³»ç»Ÿæµ‹è¯•</h2>
            <div class="test-result" id="design-test">æ­£åœ¨æµ‹è¯•CSSå˜é‡å’Œç»„ä»¶...</div>
            <div class="component-showcase">
                <button class="btn btn-primary">ä¸»æŒ‰é’®</button>
                <button class="btn btn-secondary">æ¬¡æŒ‰é’®</button>
                <span class="badge badge-success">æˆåŠŸ</span>
                <span class="badge badge-warning">è­¦å‘Š</span>
                <span class="badge badge-error">é”™è¯¯</span>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>å¡ç‰‡æµ‹è¯•</h3>
                </div>
                <div class="card-body">
                    <p>å¡ç‰‡å†…å®¹åŒºåŸŸï¼Œä½¿ç”¨ç»Ÿä¸€çš„è®¾è®¡å˜é‡ã€‚</p>
                </div>
            </div>
        </div>

        <!-- å¸‚åœºæ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h2 class="section-title">2. å¸‚åœºæ•°æ®ç³»ç»Ÿæµ‹è¯•</h2>
            <div class="test-result" id="market-test">æ­£åœ¨æµ‹è¯•å¸‚åœºæ•°æ®æ¨¡å—...</div>
            <div class="feature-demo" id="market-demo"></div>
        </div>

        <!-- å‘Šè­¦ç³»ç»Ÿæµ‹è¯• -->  
        <div class="test-section">
            <h2 class="section-title">3. å‘Šè­¦ç³»ç»Ÿæµ‹è¯•</h2>
            <div class="test-result" id="alarm-test">æ­£åœ¨æµ‹è¯•å‘Šè­¦ç³»ç»Ÿæ¨¡å—...</div>
            <div class="feature-demo" id="alarm-demo"></div>
        </div>

        <!-- AIåˆ†ææµ‹è¯• -->
        <div class="test-section">
            <h2 class="section-title">4. AIåˆ†æé¢æ¿æµ‹è¯•</h2>
            <div class="test-result" id="ai-test">æ­£åœ¨æµ‹è¯•AIå†³ç­–å¼•æ“...</div>
            <div class="feature-demo" id="ai-demo"></div>
        </div>

        <!-- æ•´åˆçŠ¶æ€ -->
        <div class="test-section">
            <h2 class="section-title">5. æ•´ä½“é›†æˆçŠ¶æ€</h2>
            <div class="test-result" id="integration-status">æ­£åœ¨æ£€æŸ¥æ•´ä½“é›†æˆçŠ¶æ€...</div>
            <div class="grid grid-2 gap-md">
                <div class="card">
                    <div class="card-body">
                        <h4>âœ… å®ŒæˆåŠŸèƒ½</h4>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>ç»Ÿä¸€è®¾è®¡ç³»ç»Ÿ (CSSå˜é‡)</li>
                            <li>è§’è‰²é€‰æ‹©é¡µé¢å¸ƒå±€å¯¹é½</li>
                            <li>AEMOå¸‚åœºæ•°æ®åˆ†æ</li>
                            <li>å®Œæ•´å‘Šè­¦ç³»ç»Ÿ</li>
                            <li>AIå†³ç­–å¼•æ“</li>
                            <li>å“åº”å¼è®¾è®¡</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h4>ğŸ“Š æ•°æ®å¯¹é½</h4>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>æ¾³æ´²5ä¸ªç”µåŠ›åŒºåŸŸä»·æ ¼</li>
                            <li>ç”µæ± å‚æ•°é…ç½® (2.5MW/10MWh)</li>
                            <li>å‘Šè­¦åˆ†ç±»å’ŒçŠ¶æ€æ ‡å‡†</li>
                            <li>AIåˆ†æç®—æ³•</li>
                            <li>å‚è€ƒæ–‡ä»¶æ ‡å‡†å…¼å®¹</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•å‡½æ•°
        function runTests() {
            console.log('å¼€å§‹åŠŸèƒ½é›†æˆæµ‹è¯•...');
            
            // 1. æµ‹è¯•è®¾è®¡ç³»ç»Ÿ
            testDesignSystem();
            
            // 2. æµ‹è¯•å¸‚åœºæ•°æ®
            testMarketData();
            
            // 3. æµ‹è¯•å‘Šè­¦ç³»ç»Ÿ
            testAlarmSystem();
            
            // 4. æµ‹è¯•AIåˆ†æ
            testAIAnalysis();
            
            // 5. æ•´ä½“çŠ¶æ€
            updateIntegrationStatus();
        }
        
        function testDesignSystem() {
            try {
                // æ£€æŸ¥CSSå˜é‡æ˜¯å¦æ­£ç¡®åŠ è½½
                const testEl = document.createElement('div');
                testEl.className = 'btn btn-primary';
                document.body.appendChild(testEl);
                
                const computedStyle = window.getComputedStyle(testEl);
                const bgColor = computedStyle.backgroundColor;
                
                document.body.removeChild(testEl);
                
                if (bgColor && bgColor !== 'rgba(0, 0, 0, 0)') {
                    document.getElementById('design-test').innerHTML = 'âœ… è®¾è®¡ç³»ç»Ÿæ­£å¸¸åŠ è½½ï¼ŒCSSå˜é‡å·¥ä½œæ­£å¸¸';
                    document.getElementById('design-test').className = 'test-result test-success';
                } else {
                    throw new Error('CSSå˜é‡æœªæ­£ç¡®åº”ç”¨');
                }
            } catch (error) {
                document.getElementById('design-test').innerHTML = 'âŒ è®¾è®¡ç³»ç»Ÿé”™è¯¯: ' + error.message;
                document.getElementById('design-test').className = 'test-result test-error';
            }
        }
        
        function testMarketData() {
            try {
                if (typeof MarketData === 'undefined') {
                    throw new Error('MarketData æ¨¡å—æœªåŠ è½½');
                }
                
                // æµ‹è¯•åŒºåŸŸä»·æ ¼æ•°æ®
                const regionPrices = MarketData.regionPrices;
                if (!regionPrices || !regionPrices.NSW) {
                    throw new Error('åŒºåŸŸä»·æ ¼æ•°æ®ç¼ºå¤±');
                }
                
                // æµ‹è¯•AEMOæ•°æ®ç”Ÿæˆ
                const mockData = MarketData.generateMockAEMOData();
                if (!mockData.labels || !mockData.priceData) {
                    throw new Error('AEMOæ•°æ®ç”Ÿæˆå¤±è´¥');
                }
                
                // æµ‹è¯•AIåˆ†æ
                const analysis = MarketData.generateAIAnalysis(mockData);
                if (!analysis.decision || !analysis.confidence) {
                    throw new Error('AIåˆ†æåŠŸèƒ½å¼‚å¸¸');
                }
                
                // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
                document.getElementById('market-test').innerHTML = 
                    `âœ… å¸‚åœºæ•°æ®æ¨¡å—æ­£å¸¸: ${Object.keys(regionPrices).length}ä¸ªåŒºåŸŸ, ${mockData.labels.length}ä¸ªæ•°æ®ç‚¹, AIå†³ç­–: ${analysis.decision}`;
                document.getElementById('market-test').className = 'test-result test-success';
                
                // æ˜¾ç¤ºå¸‚åœºé¢æ¿demo
                const highest = MarketData.getHighestPriceRegion();
                document.getElementById('market-demo').innerHTML = `
                    <h4>å¸‚åœºæ•°æ®ç¤ºä¾‹</h4>
                    <div class="grid grid-3 gap-md">
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="text-lg font-bold">æœ€é«˜ä»·åŒºåŸŸ</div>
                                <div class="text-xl text-warning">${highest.region}</div>
                                <div class="text-2xl font-bold">$${highest.price}</div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="text-lg font-bold">AIå†³ç­–</div>
                                <div class="badge badge-${analysis.decision === 'CHARGE' ? 'success' : analysis.decision === 'DISCHARGE' ? 'warning' : 'secondary'}">${analysis.decision}</div>
                                <div class="text-sm">ç½®ä¿¡åº¦: ${analysis.confidence}</div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="text-lg font-bold">å¥—åˆ©ä»·å·®</div>
                                <div class="text-xl font-bold">$${analysis.arbitrageSpread.toFixed(2)}</div>
                                <div class="text-sm">é¢„æœŸæ”¶ç›Š: $${analysis.potentialProfit.toFixed(0)}</div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('market-test').innerHTML = 'âŒ å¸‚åœºæ•°æ®é”™è¯¯: ' + error.message;
                document.getElementById('market-test').className = 'test-result test-error';
            }
        }
        
        function testAlarmSystem() {
            try {
                if (typeof AlarmSystem === 'undefined') {
                    throw new Error('AlarmSystem æ¨¡å—æœªåŠ è½½');
                }
                
                // æµ‹è¯•å‘Šè­¦ç”Ÿæˆ
                const alarms = AlarmSystem.generateMockAlarms(10);
                if (!alarms || alarms.length !== 10) {
                    throw new Error('å‘Šè­¦æ•°æ®ç”Ÿæˆå¤±è´¥');
                }
                
                // æµ‹è¯•ç»Ÿè®¡åŠŸèƒ½
                const stats = AlarmSystem.getAlarmStatistics(alarms);
                if (!stats || typeof stats.total !== 'number') {
                    throw new Error('å‘Šè­¦ç»Ÿè®¡åŠŸèƒ½å¼‚å¸¸');
                }
                
                // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
                document.getElementById('alarm-test').innerHTML = 
                    `âœ… å‘Šè­¦ç³»ç»Ÿæ­£å¸¸: ç”Ÿæˆ${alarms.length}æ¡å‘Šè­¦, ${stats.unprocessed}æ¡æœªå¤„ç†, ${stats.danger}æ¡å±é™©`;
                document.getElementById('alarm-test').className = 'test-result test-success';
                
                // æ˜¾ç¤ºå‘Šè­¦demo
                const recentAlarms = alarms.slice(0, 3);
                document.getElementById('alarm-demo').innerHTML = `
                    <h4>å‘Šè­¦ç³»ç»Ÿç¤ºä¾‹</h4>
                    ${AlarmSystem.renderAlarmStatsPanel(stats)}
                    <div class="mt-4">
                        <h5>æœ€è¿‘å‘Šè­¦:</h5>
                        ${recentAlarms.map(alarm => AlarmSystem.renderAlarmCard(alarm)).join('')}
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('alarm-test').innerHTML = 'âŒ å‘Šè­¦ç³»ç»Ÿé”™è¯¯: ' + error.message;
                document.getElementById('alarm-test').className = 'test-result test-error';
            }
        }
        
        function testAIAnalysis() {
            try {
                if (typeof MarketData === 'undefined') {
                    throw new Error('MarketData æ¨¡å—æœªåŠ è½½ï¼Œæ— æ³•æµ‹è¯•AIåˆ†æ');
                }
                
                // ç”ŸæˆAIåˆ†æé¢æ¿
                const aiPanel = MarketData.renderAIAnalysisPanel();
                if (!aiPanel || aiPanel.length < 100) {
                    throw new Error('AIåˆ†æé¢æ¿ç”Ÿæˆå¤±è´¥');
                }
                
                document.getElementById('ai-test').innerHTML = 'âœ… AIåˆ†æé¢æ¿æ­£å¸¸ç”Ÿæˆ';
                document.getElementById('ai-test').className = 'test-result test-success';
                
                // æ˜¾ç¤ºAIé¢æ¿demo
                document.getElementById('ai-demo').innerHTML = `
                    <h4>AIåˆ†æé¢æ¿ç¤ºä¾‹</h4>
                    ${aiPanel}
                `;
                
            } catch (error) {
                document.getElementById('ai-test').innerHTML = 'âŒ AIåˆ†æé”™è¯¯: ' + error.message;
                document.getElementById('ai-test').className = 'test-result test-error';
            }
        }
        
        function updateIntegrationStatus() {
            const hasMarketData = typeof MarketData !== 'undefined';
            const hasAlarmSystem = typeof AlarmSystem !== 'undefined';
            
            const statusEl = document.getElementById('integration-status');
            
            if (hasMarketData && hasAlarmSystem) {
                statusEl.innerHTML = 'âœ… æ‰€æœ‰æ¨¡å—æ­£å¸¸é›†æˆï¼Œç³»ç»Ÿå¯ä»¥æŠ•å…¥ä½¿ç”¨';
                statusEl.className = 'test-result test-success';
            } else {
                const missing = [];
                if (!hasMarketData) missing.push('MarketData');
                if (!hasAlarmSystem) missing.push('AlarmSystem');
                
                statusEl.innerHTML = 'âŒ ç¼ºå°‘æ¨¡å—: ' + missing.join(', ');
                statusEl.className = 'test-result test-error';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>